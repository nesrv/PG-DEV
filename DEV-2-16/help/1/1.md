![alt text](image-4.png)

![alt text](image-10.png)

![alt text](image-11.png)


![alt text](image-12.png)


ÐšÐ¾Ð³Ð´Ð° Ð¼Ñ‹ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð¼ Ð¾ **Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸**, Ð¼Ñ‹ Ð¸Ð¼ÐµÐµÐ¼ Ð² Ð²Ð¸Ð´Ñƒ Ð½Ð°Ð±Ð¾Ñ€ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ð½Ð°Ð´ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€ÐµÐ²ÐµÑÑ‚Ð¸ ÐµÑ‘ Ð¸Ð· Ð¾Ð´Ð½Ð¾Ð³Ð¾ **ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ** Ð² Ð´Ñ€ÑƒÐ³Ð¾Ðµ.

Ð§Ñ‚Ð¾ Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ *ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ*? Ð­Ñ‚Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ ÑƒÐ´Ð¾Ð²Ð»ÐµÑ‚Ð²Ð¾Ñ€ÑÐµÑ‚ Ð²ÑÐµÐ¼ **Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸ÑÐ¼ Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸** â€” ÐºÐ°Ðº Ñ‚ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð´Ð°Ð½Ñ‹ Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ñ‚Ð°Ðº Ð¸ Ñ‚ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÑŽÑ‚ÑÑ Ð»Ð¾Ð³Ð¸ÐºÐ¾Ð¹ ÑÐ°Ð¼Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ.

Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð½Ð¾ÑÐ¸Ñ‚ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ, ÑÑ‡Ð¸Ñ‚Ð°Ð»Ð¸ÑÑŒ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¼Ð¸, Ð²Ð°Ð¶Ð½Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð±Ñ‹Ð»Ð¸ ÑÐ¾Ð±Ð»ÑŽÐ´ÐµÐ½Ñ‹ **Ñ‚Ñ€Ð¸ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð°**:

* **ÐÑ‚Ð¾Ð¼Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒ** â€” Ð»Ð¸Ð±Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð²ÑÑ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼, Ð»Ð¸Ð±Ð¾ Ð½Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð½Ð¸Ñ‡ÐµÐ³Ð¾;
* **Ð¡Ð¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ð¾ÑÑ‚ÑŒ** â€” Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ Ð² ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸;
* **Ð˜Ð·Ð¾Ð»ÑÑ†Ð¸Ñ** â€” Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð½Ðµ Ð¼ÐµÑˆÐ°ÑŽÑ‚ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ñƒ.



Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹ **ACID** Ð½Ð° Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¼ Ð¸ Ð¿Ð¾Ð½ÑÑ‚Ð½Ð¾Ð¼ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ â€“ **Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ðµ Ð´ÐµÐ½ÐµÐ³ Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¾Ð³Ð¾ ÑÑ‡Ñ‘Ñ‚Ð° Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ð¹**.

---

### ðŸ’³ Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹:

ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ñ‚ **1000 Ñ€ÑƒÐ±Ð»ÐµÐ¹** ÑÐ¾ ÑÑ‡Ñ‘Ñ‚Ð° Ð Ð½Ð° ÑÑ‡Ñ‘Ñ‚ B.

---

### ðŸ”¹ A â€” *ÐÑ‚Ð¾Ð¼Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒ*

ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒÑÑ **Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼ Ð¸Ð»Ð¸ Ð½Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒÑÑ Ð²Ð¾Ð²ÑÐµ**.
ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐµÑÐ»Ð¸ 1000 Ñ€ÑƒÐ±Ð»ÐµÐ¹ ÑÐ¿Ð¸ÑÐ°Ð»Ð¸ÑÑŒ ÑÐ¾ ÑÑ‡Ñ‘Ñ‚Ð° Ð, Ð½Ð¾ Ð¸Ð·-Ð·Ð° ÑÐ±Ð¾Ñ Ð½Ðµ Ð±Ñ‹Ð»Ð¸ Ð·Ð°Ñ‡Ð¸ÑÐ»ÐµÐ½Ñ‹ Ð½Ð° ÑÑ‡Ñ‘Ñ‚ B â€” ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÐµÑÑŒ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´.

**ÐŸÑ€Ð¾ÑÑ‚Ð¾: Ð»Ð¸Ð±Ð¾ Ð¾Ð±Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ, Ð»Ð¸Ð±Ð¾ Ð½Ð¸ Ð¾Ð´Ð½Ð¾Ð³Ð¾.**

---

### ðŸ”¹ C â€” *Ð¡Ð¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ð¾ÑÑ‚ÑŒ*

ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð²ÑÐµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ‚ÑŒÑÑ.
ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, **Ð¾Ð±Ñ‰ÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´ÐµÐ½ÐµÐ³ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð´Ð¾ Ð¸ Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° Ð¾Ð´Ð¸Ð½Ð°ÐºÐ¾Ð²Ð¾** â€” Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð½Ðµ "Ð¿Ñ€Ð¾Ð¿Ð°Ð»Ð¸" Ð¸ Ð½Ðµ "Ð¿Ð¾ÑÐ²Ð¸Ð»Ð¸ÑÑŒ Ð¸Ð· Ð²Ð¾Ð·Ð´ÑƒÑ…Ð°".

---

### ðŸ”¹ I â€” *Ð˜Ð·Ð¾Ð»ÑÑ†Ð¸Ñ*

Ð•ÑÐ»Ð¸ Ð² Ñ‚Ð¾ Ð¶Ðµ ÑÐ°Ð¼Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð´Ñ€ÑƒÐ³Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ, Ð¾Ð½Ð° **Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¼ÐµÑˆÐ°Ñ‚ÑŒ** Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹.
Ð”Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼, ÐºÐ»Ð¸ÐµÐ½Ñ‚ B Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð²Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð´ÐµÐ½ÑŒÐ³Ð¸ ÑÐ¾ ÑÐ²Ð¾ÐµÐ³Ð¾ ÑÑ‡Ñ‘Ñ‚Ð° Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð·Ð°Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ñ. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ **Ð¾Ð½ Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÐµÑ‰Ñ‘ Ð½Ðµ Ð¿Ð¾ÑÑ‚ÑƒÐ¿Ð¸Ð²ÑˆÐ¸Ð¼ Ð´ÐµÐ½ÑŒÐ³Ð°Ð¼**.

---

### ðŸ”¹ D â€” *Ð”Ð¾Ð»Ð³Ð¾Ð²ÐµÑ‡Ð½Ð¾ÑÑ‚ÑŒ*

ÐŸÐ¾ÑÐ»Ðµ Ñ‚Ð¾Ð³Ð¾ ÐºÐ°Ðº ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ð»Ð°, Ñ‡Ñ‚Ð¾ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ â€” **Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð´Ð°Ð¶Ðµ Ð¿Ñ€Ð¸ ÑÐ±Ð¾Ðµ**.
Ð”Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÑÐµÑ€Ð²ÐµÑ€ "ÑƒÐ¿Ð°Ð»", Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ° Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ **Ð½Ðµ Ð¸ÑÑ‡ÐµÐ·Ð½ÐµÑ‚**.

---



ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ð²Ð°Ð¶Ð½Ð¾ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸. Ð’ Ð¸Ð´ÐµÐ°Ð»Ðµ â€” ÐµÑÐ»Ð¸ Ð±Ñ‹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐ»Ð°ÑÑŒ Ð² Ð¿Ð¾Ð»Ð½Ð¾Ð¼ Ð¾Ð´Ð¸Ð½Ð¾Ñ‡ÐµÑÑ‚Ð²Ðµ â€” Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ ÐµÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð½Ðµ Ð·Ð°Ð²Ð¸ÑÐµÐ» Ð±Ñ‹ Ð¾Ñ‚ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹. ÐÐ¾ Ð½Ð° Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐµ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ñ Ñ‡Ð°ÑÑ‚Ð¾ **Ð¾ÑÐ»Ð°Ð±Ð»ÑÐµÑ‚ÑÑ**, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð²Ñ‹ÑÐ¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ. Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ðº Ñ‚Ð°Ðº Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ð¼ **Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸ÑÐ¼** â€” ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÑÐ¼, ÐºÐ¾Ð³Ð´Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð½ÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¼ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð¸Ð·-Ð·Ð° Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑÐ¼Ð¸.

ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ñ â€” ÑÑ‚Ð¾ Ð´Ð¾Ñ€Ð¾Ð³Ð¾ Ð¸ ÑÐ»Ð¾Ð¶Ð½Ð¾. ÐŸÐ¾ÑÑ‚Ð¾Ð¼Ñƒ Ð²Ð°Ð¶Ð½Ð¾ **Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ, ÐºÐ°ÐºÐ¸Ðµ Ñ€Ð¸ÑÐºÐ¸ Ð¼Ñ‹ Ð±ÐµÑ€Ñ‘Ð¼ Ð½Ð° ÑÐµÐ±Ñ**, ÑÐ½Ð¸Ð¶Ð°Ñ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸.

Ðž Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¼ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ðµ â€” **Ð´Ð¾Ð»Ð³Ð¾Ð²ÐµÑ‡Ð½Ð¾ÑÑ‚Ð¸ (durability)** â€” Ð¼Ñ‹ Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð¼ Ð¿Ð¾Ð·Ð¶Ðµ, ÐºÐ¾Ð³Ð´Ð° Ð±ÑƒÐ´ÐµÐ¼ Ð¾Ð±ÑÑƒÐ¶Ð´Ð°Ñ‚ÑŒ **Ð¶ÑƒÑ€Ð½Ð°Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ**.



![alt text](image-13.png)




**SQL-ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ñ‡ÐµÑ‚Ñ‹Ñ€Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹**, Ð¸ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¸Ð· Ð½Ð¸Ñ… Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð¸Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ñ‹Ðµ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¸ Ð¿Ñ€Ð¸ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ.

**Ð¡Ð°Ð¼Ñ‹Ð¹ ÑÐ»Ð°Ð±Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ â€” Read Uncommitted**. ÐšÐ°Ðº Ð²Ð¸Ð´Ð½Ð¾ Ð¸Ð· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ, Ð½Ð° ÑÑ‚Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¼Ð¾Ð¶ÐµÑ‚ *Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð´Ð°Ð¶Ðµ Ð½ÐµÐ·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹*. Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ðº Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ñƒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼.

ÐžÐ´Ð½Ð°ÐºÐ¾, ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñƒ, Ð´Ð°Ð¶Ðµ Ð½Ð° ÑÑ‚Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð° Ð¾Ð´Ð½Ð° ÐºÐ»ÑŽÑ‡ÐµÐ²Ð°Ñ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ñ â€” **Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ** (*lost updates*). Ð§Ñ‚Ð¾ ÑÑ‚Ð¾ Ð·Ð½Ð°Ñ‡Ð¸Ñ‚? Ð”Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼, Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T1 Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸. ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾ Ð´Ñ€ÑƒÐ³Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T2 Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð° ÑÑ‚Ð¸ Ð¶Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ ÑƒÑÐ¿ÐµÐ»Ð° Ð¸Ñ… Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ. Ð•ÑÐ»Ð¸ T1 Ð¿Ð¾Ñ‚Ð¾Ð¼ "Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑˆÐµÑ‚" ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð½Ðµ Ð·Ð°Ð¼ÐµÑ‚Ð¸Ð² Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ T2 â€” ÑÑ‚Ð¾ Ð¸ ÐµÑÑ‚ÑŒ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ð¾Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ.

Ð˜Ð¼ÐµÐ½Ð½Ð¾ ÑÑ‚Ñƒ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÑŽ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒ Ð´Ð°Ð¶Ðµ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Read Uncommitted.

ÐÐ¾ ÐµÑÑ‚ÑŒ Ð²Ð°Ð¶Ð½Ñ‹Ð¹ Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚:
**PostgreSQL Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð½Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÑ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Read Uncommitted**. ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð° Ð¿Ñ€Ð¾ÑÑ‚Ð° â€” Ð´Ð°Ð¶Ðµ Ð±ÐµÐ· Ð¿Ð¾Ñ‚ÐµÑ€ÑŒ Ð² Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ PostgreSQL Ð¼Ð¾Ð¶ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½Ð° Ð±Ð¾Ð»ÐµÐµ ÑÑ‚Ñ€Ð¾Ð³Ð¸Ñ… ÑƒÑ€Ð¾Ð²Ð½ÑÑ…. ÐŸÐ¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¾Ð± ÑÑ‚Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¼Ñ‹ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð½Ðµ Ð±ÑƒÐ´ÐµÐ¼.

---

![alt text](image-14.png)

ÐšÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð² SQL ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ðµ ÑƒÑÐ¸Ð»Ð¸Ð²Ð°ÐµÑ‚ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ Ðº ÐºÐ¾Ð½ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐŸÐ¾ÑÐ»Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ *Read Uncommitted*, ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ â€” *Read Committed* â€” Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ñ‚ÐµÑ€ÑŽ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ (*lost updates*), Ð½Ð¾ Ð¸ Ñ‚Ð°Ðº Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÐ¼Ð¾Ðµ Â«Ð³Ñ€ÑÐ·Ð½Ð¾Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸ÐµÂ» (*dirty read*).

ÐŸÑ€Ð¸Ð¼ÐµÑ€: ÐµÑÐ»Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T1 Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÑƒ, Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½Ð½ÑƒÑŽ, Ð½Ð¾ ÐµÑ‰Ñ‘ Ð½Ðµ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½ÑƒÑŽ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÐµÐ¹ T2, Ð° Ð·Ð°Ñ‚ÐµÐ¼ T2 Ð´ÐµÐ»Ð°ÐµÑ‚ *ROLLBACK*, Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ T1 Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð»Ð° Ð´Ð°Ð½Ð½Ñ‹Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð½Ð° ÑÐ°Ð¼Ð¾Ð¼ Ð´ÐµÐ»Ðµ Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð»Ð¾.

ÐžÐ´Ð½Ð°ÐºÐ¾, Ð´Ð°Ð¶Ðµ Ð¿Ñ€Ð¸ ÑÑ‚Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¸, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð²Ð°Ð¶Ð½Ð¾ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ: *Read Committed* â€” ÑÑ‚Ð¾ ÐºÐ¾Ð¼Ð¿Ñ€Ð¾Ð¼Ð¸ÑÑ. Ð’ PostgreSQL Ð¾Ð½ Ð²Ñ‹Ð±Ñ€Ð°Ð½ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ñ…Ð¾Ñ€Ð¾ÑˆÑƒÑŽ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¸ÐµÐ¼Ð»ÐµÐ¼Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð½Ð°Ð´Ñ‘Ð¶Ð½Ð¾ÑÑ‚Ð¸.

Ð’Ð°Ð¶Ð½Ð¾ Ð¿Ð¾Ð´Ñ‡ÐµÑ€ÐºÐ½ÑƒÑ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð² PostgreSQL Ð´Ð°Ð¶Ðµ Ð½Ð° ÑÑ‚Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹ Ð¿Ð¾Ñ‚ÐµÑ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹. ÐœÑ‹ Ð¿Ð¾ÐºÐ°Ð¶ÐµÐ¼ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð² Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸.

---

# Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¼ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸

Ð”Ð»Ñ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¼Ñ‹ Ð±ÑƒÐ´ÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½ÑƒÑŽ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ñ‚ÐµÐ¼Ñ‹.

```sql
=> CREATE DATABASE arch_isolation;
CREATE DATABASE
=> \c arch_isolation
You are now connected to database "arch_isolation" as user "student".
````

Ð£Ñ€Ð¾Ð²Ð½Ð¸ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼ Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹, Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÑŽÑ‰ÐµÐ¹ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð¿ÐµÑˆÐµÑ…Ð¾Ð´Ð½Ð¾Ð³Ð¾ ÑÐ²ÐµÑ‚Ð¾Ñ„Ð¾Ñ€Ð° Ñ Ð´Ð²ÑƒÐ¼Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ°Ð¼Ð¸:

```sql
=> CREATE TABLE lights(
  id integer GENERATED ALWAYS AS IDENTITY,
  lamp text,
  state text
);
CREATE TABLE

-- Ð­Ñ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¿ÐµÑˆÐµÑ…Ð¾Ð´Ð½Ñ‹Ð¹ ÑÐ²ÐµÑ‚Ð¾Ñ„Ð¾Ñ€ Ñ Ð´Ð²ÑƒÐ¼Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ°Ð¼Ð¸:

=> INSERT INTO lights(lamp,state) VALUES
    ('red', 'on'), ('green', 'off');
INSERT 0 2

=> SELECT * FROM lights ORDER BY id;
 id | lamp  | state 
----+-------+-------
  1 | red   | on
  2 | green | off
(2 rows)
```

ÐžÐ´Ð¸Ð½ Ð¸Ð· ÑÐ¿Ð¾ÑÐ¾Ð±Ð¾Ð² ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ â€” ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° `SET TRANSACTION`, Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ð°Ñ Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸:

```sql
=> BEGIN;
BEGIN
=> SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
SET

-- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¼Ð¾Ð¶Ð½Ð¾, Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ² Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°:

=> SHOW transaction_isolation;
 transaction_isolation 
-----------------------
 read committed
(1 row)

=> COMMIT;
COMMIT
```

ÐœÐ¾Ð¶Ð½Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð¿Ñ€ÑÐ¼Ð¾ Ð² ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ `BEGIN`:

```sql
=> BEGIN ISOLATION LEVEL READ COMMITTED;
BEGIN
=> COMMIT;
COMMIT
```

ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ `Read Committed`:

```sql
=> SHOW default_transaction_isolation;
 default_transaction_isolation 
-------------------------------
 read committed
(1 row)
```

Ð•ÑÐ»Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð½Ðµ Ð¼ÐµÐ½ÑÐ»ÑÑ, Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ðµ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ ÑÐ²Ð½Ð¾.

---

## Read Committed Ð¸ Ð³Ñ€ÑÐ·Ð½Ð¾Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ

ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Â«Ð³Ñ€ÑÐ·Ð½Ñ‹ÐµÂ» Ð´Ð°Ð½Ð½Ñ‹Ðµ. Ð’ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð³Ð°ÑÐ¸Ð¼ ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹ ÑÐ²ÐµÑ‚:

```sql
=> BEGIN;
BEGIN
=> UPDATE lights SET state = 'off' WHERE lamp = 'red';
UPDATE 1
```

ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ ÑÐµÐ°Ð½Ñ:

```shell
student$ psql arch_isolation
```

Ð’ Ð½ÐµÐ¼ Ð¾Ñ‚ÐºÑ€Ð¾ÐµÐ¼ ÐµÑ‰Ñ‘ Ð¾Ð´Ð½Ñƒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ Ñ Ñ‚ÐµÐ¼ Ð¶Ðµ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¼ `Read Committed`:

```sql
| => BEGIN;
| BEGIN
| => SELECT * FROM lights ORDER BY id;
|  id | lamp  | state 
| ----+-------+-------
|   1 | red   | on
|   2 | green | off
| (2 rows)
```

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ **Ð½Ðµ Ð²Ð¸Ð´Ð¸Ñ‚** Ð½ÐµÐ·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹.

ÐžÑ‚Ð¼ÐµÐ½Ð¸Ð¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ:

```sql
=> ROLLBACK;
ROLLBACK
| => ROLLBACK;
| ROLLBACK
```

---

## Read Committed Ð¸ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´ÐµÑ‚ Ð¿Ð¾ÑÐ»Ðµ Ñ„Ð¸ÐºÑÐ°Ñ†Ð¸Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹.

ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ:

```sql
=> BEGIN;
BEGIN
=> UPDATE lights SET state = 'off' WHERE lamp = 'red';
UPDATE 1
```

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ:

```sql
| => BEGIN;
| BEGIN
| => SELECT * FROM lights ORDER BY id;
|  id | lamp  | state 
| ----+-------+-------
|   1 | red   | on
|   2 | green | off
| (2 rows)
```

ÐŸÐ¾ÐºÐ° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð½Ðµ Ð²Ð¸Ð´Ð½Ð¾.

ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ:

```sql
=> COMMIT;
COMMIT
```

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸:

```sql
| => SELECT * FROM lights ORDER BY id;
|  id | lamp  | state 
| ----+-------+-------
|   1 | red   | off
|   2 | green | off
| (2 rows)

| => COMMIT;
| COMMIT
```

Ð’ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ `Read Committed` Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð¾Ð´Ð½Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð²Ð¸Ð´ÑÑ‚ **Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ** Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹.

---

## Ð’Ð°Ð¶Ð½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚

Ð’ Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¾Ð´Ð¸Ð½ Ð¸ Ñ‚Ð¾Ñ‚ Ð¶Ðµ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹.

Ð•ÑÐ»Ð¸ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð´Ð¾Ð»Ð³Ð¾, Ð¸ Ð·Ð° ÑÑ‚Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð´Ñ€ÑƒÐ³Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ â€” Ð¾Ð½Ð¸ **Ð½Ðµ Ð±ÑƒÐ´ÑƒÑ‚ Ð²Ð¸Ð´Ð½Ñ‹** Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°, Ð½Ð¾ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð²Ð¸Ð´Ð½Ñ‹ Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ðµ.

ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹:

```sql
=> SELECT *, pg_sleep(2) FROM lights ORDER BY id;
```

ÐŸÐ¾ÐºÐ° ÑÑ‚Ð¾Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ, Ð²Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¼ ÑÐµÐ°Ð½ÑÐµ:

```sql
| => UPDATE lights SET state = 'on';
| UPDATE 2
```

| id | lamp  | state | pg_sleep |
|----|-------|-------|----------|
| 1  | red   | off   |          |
| 2  | green | off   |          |

(2 rows)


Ð˜Ñ‚Ð°Ðº, ÐµÑÐ»Ð¸ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð° Ð´Ñ€ÑƒÐ³Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ ÑƒÑÐ¿ÐµÐ»Ð° Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ, Ñ‚Ð¾ Ð¾Ð½Ð¸ Ð½Ðµ Ð±ÑƒÐ´ÑƒÑ‚ Ð²Ð¸Ð´Ð½Ñ‹. 

ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ð²Ð¸Ð´Ð¸Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ñ‚Ð°ÐºÐ¾Ð¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð¾Ð½Ð¸ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð»Ð¸ÑÑŒ Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð½Ð°Ñ‡Ð°Ð»Ð° ÐµÐ³Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ.


---

## Ð’Ñ‹Ð·Ð¾Ð² volatile-Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ

Ð•ÑÐ»Ð¸ Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÐµÐ¹ Ð¸Ð·Ð¼ÐµÐ½Ñ‡Ð¸Ð²Ð¾ÑÑ‚Ð¸ `volatile`, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÐµÐ±Ñ Ð´ÐµÐ»Ð°ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ, Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð½ÐµÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ñ‹Ð¼Ð¸.

ÐŸÑ€Ð¸Ð¼ÐµÑ€:

```sql
=> CREATE FUNCTION get_state(lamp text) RETURNS text
LANGUAGE sql VOLATILE
RETURN (SELECT l.state FROM lights l WHERE l.lamp = get_state.lamp);
CREATE FUNCTION

--ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ð¼ ÑÐºÑÐ¿ÐµÑ€Ð¸Ð¼ÐµÐ½Ñ‚, Ð½Ð¾ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ:



=> SELECT *, get_state(lamp), pg_sleep(2) FROM lights ORDER BY id;
=> UPDATE lights SET state = 'off';
UPDATE 2

 id | lamp  | state | get_state | pg_sleep 
----+-------+-------+-----------+----------
  1 | red   | on    | on        | 
  2 | green | on    | off       | 
(2 rows)
```

Ð ÐµÑˆÐµÐ½Ð¸Ðµ â€” Ð¾Ð±ÑŠÑÐ²Ð¸Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ ÐºÐ°Ðº `STABLE`:

```sql
=> ALTER FUNCTION get_state STABLE;
ALTER FUNCTION

=> SELECT *, get_state(lamp), pg_sleep(2) FROM lights ORDER BY id;
=> UPDATE lights SET state = 'on';
UPDATE 2

 id | lamp  | state | get_state | pg_sleep 
----+-------+-------+-----------+----------
  1 | red   | off   | off       | 
  2 | green | off   | off       | 
(2 rows)
```

Ð’Ñ‹Ð²Ð¾Ð´: Ð²Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÐ»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÐµÐ¹ Ð¸Ð·Ð¼ÐµÐ½Ñ‡Ð¸Ð²Ð¾ÑÑ‚Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ `Read Committed`. Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¿Ñ€Ð¸Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ðº Ð½ÐµÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ð´Ð°Ð½Ð½Ñ‹Ð¼.

---

## Read Committed Ð¸ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ

Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚, ÐµÑÐ»Ð¸ Ð´Ð²Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¿Ñ‹Ñ‚Ð°ÑŽÑ‚ÑÑ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¾Ð´Ð½Ñƒ Ð¸ Ñ‚Ñƒ Ð¶Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ?

Ð’ÑÐµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹:

ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÐºÑ€Ð°ÑÐ½ÑƒÑŽ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÑƒ, Ð½Ð¾ Ð¿Ð¾ÐºÐ° Ð½Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚ÑÑ.:

```sql
=> BEGIN;
BEGIN
=> UPDATE lights SET state = 'off' WHERE lamp = 'red';
UPDATE 1
```

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð²Ð¸Ð´Ð¸Ñ‚, Ñ‡Ñ‚Ð¾ Ð¾Ð±Ðµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð³Ð¾Ñ€ÑÑ‚...:

```sql
| => BEGIN;
| BEGIN
| => SELECT * FROM lights;
|  id | lamp  | state 
| ----+-------+-------
|   2 | green | on
|   1 | red   | on
| (2 rows)

-- ... Ð¼ÐµÐ½ÑÐµÑ‚ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸...

| => UPDATE lights
| SET state = CASE WHEN state = 'on' THEN 'off' ELSE 'on' END;
```

\| Ð½Ð¾ Ð·Ð°Ð²Ð¸ÑÐ°ÐµÑ‚, Ð¾Ð¶Ð¸Ð´Ð°Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿ÐµÑ€Ð²Ð¾Ð¹.

ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ:

```sql
=> COMMIT;
COMMIT
```

\| Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑ‚:

```sql
UPDATE 2
```

ÐŸÐ¾ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð²Ñ‚Ð¾Ñ€Ð°Ñ ÑÐ¼Ð¾Ð³Ð»Ð° Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð¸ Ð¼Ñ‹ Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð²Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¼ ÑÐµÐ°Ð½ÑÐµ Ð¾Ð±Ðµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹.
ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¾Ð±Ðµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹.

ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼:

```sql
=> COMMIT;
COMMIT
=> SELECT * FROM lights;
 id | lamp  | state 
----+-------+-------
  2 | green | off
  1 | red   | on
(2 rows)
```

ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ ÐºÑ€Ð°ÑÐ½Ð°Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ° ÑÐ½Ð¾Ð²Ð° **Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°**?

ÐžÐ±ÑŠÑÑÐ½ÐµÐ½Ð¸Ðµ:

ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° UPDATE Ð²Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð¿Ð¾ Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸. Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ÑÑ Ð·ÐµÐ»ÐµÐ½Ð°Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ° Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ, Ð° Ð·Ð°Ñ‚ÐµÐ¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¶Ð´ÐµÑ‚ ÑÐ½ÑÑ‚Ð¸Ñ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¸ ÐºÑ€Ð°ÑÐ½Ð¾Ð¹ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÐµÐ¹.

ÐŸÑ€Ð¸ ÑÑ‚Ð¾Ð¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð²Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹, ÑÐ´ÐµÐ»Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ÑÐ»Ðµ Ð½Ð°Ñ‡Ð°Ð»Ð° ÐµÐµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ. Ð¡ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹, Ð¾Ð½Ð° Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¿Ð¾Ñ‚ÐµÑ€ÑÑ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ, Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑÐ¼Ð¸. ÐŸÐ¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¿Ð¾ÑÐ»Ðµ ÑÐ½ÑÑ‚Ð¸Ñ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¸ Ð¾Ð½Ð° Ð¿ÐµÑ€ÐµÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÑƒ, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ.

Ð’ Ð¸Ñ‚Ð¾Ð³Ðµ, Ð¿ÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÐºÑ€Ð°ÑÐ½ÑƒÑŽ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÑƒ, Ð° Ð²Ñ‚Ð¾Ñ€Ð°Ñ ÑÐ½Ð¾Ð²Ð° Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÐµÐµ.

Ð’ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ðµ Ð²Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¾Ñ‚Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð° ÑÑ‡ÐµÑ‚ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð° Ð²Ð¸Ð´ÐµÐ»Ð° Ð½ÐµÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ: Ñ‡Ð°ÑÑ‚ÑŒ â€” Ð½Ð° Ð¾Ð´Ð¸Ð½ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸, Ñ‡Ð°ÑÑ‚ÑŒ â€” Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ð¹.

Ð­Ñ‚Ð¾ Ð¸ ÐµÑÑ‚ÑŒ **Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ**.

---
ÐÐ¾ ÐµÑÐ»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð½Ðµ Ð² Ð¾Ð´Ð½Ð¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ SQL, Ñ‚Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð¾.


## ÐŸÐ¾Ñ‚ÐµÑ€ÑÐ½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ñ…

ÐŸÑ€Ð¸Ð¼ÐµÑ€, ÐºÐ¾Ð³Ð´Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ñ‚ÐµÑ€ÑÑŽÑ‚ÑÑ:

ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ:

```sql
=> BEGIN;
BEGIN
-- ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ñ‚ ÐºÑ€Ð°ÑÐ½ÑƒÑŽ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÑƒ Ð² Ð¼Ð¸Ð³Ð°ÑŽÑ‰Ð¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼. Ð¡Ñ‚Ñ€Ð¾ÐºÐ° Ð¿Ñ€Ð¸ ÑÑ‚Ð¾Ð¼ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ÑÑ:
=> UPDATE lights SET state = 'blink' WHERE lamp = 'red';
UPDATE 1
```

Ð’Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð²Ð¸Ð´Ð¸Ñ‚, Ñ‡Ñ‚Ð¾ ÐºÑ€Ð°ÑÐ½Ð°Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ° Ð³Ð¾Ñ€Ð¸Ñ‚...

```sql
=> BEGIN;
BEGIN
=> SELECT state AS old_state FROM lights WHERE lamp = 'red';
 old_state 
-----------
 on
(1 row)
... Ð¸ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÐµÐµ:
=> \bind off
=> UPDATE lights SET state = 'off' WHERE lamp = 'red';
```

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¶Ð´ÐµÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿ÐµÑ€Ð²Ð¾Ð¹.

ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ:

```sql
=> COMMIT;
COMMIT
```

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ:

```sql
| => COMMIT;
| COMMIT
```

ÐŸÐµÑ€Ð²Ñ‹Ð¹ ÑÐµÐ°Ð½Ñ Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ, Ñ‡Ñ‚Ð¾ ÐºÑ€Ð°ÑÐ½Ð°Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ° Ð¼Ð¸Ð³Ð°ÐµÑ‚. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼:

```sql
=> SELECT * FROM lights WHERE lamp = 'red';
 id | lamp | state 
----+------+-------
  1 | red  | off
(1 row)
```

Ð’ ÑÑ‚Ð¾Ð¼ ÑÐ»ÑƒÑ‡Ð°Ðµ Ð²Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð·Ð°Ð¿Ð¸ÑÐ°Ð»Ð° ÑÐ²Ð¾Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Â«Ð¿Ð¾Ð²ÐµÑ€Ñ…Â» Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸. ÐÐ° ÑƒÑ€Ð¾Ð²Ð½Ðµ Read Committed ÑÐµÑ€Ð²ÐµÑ€ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÑ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‚Ð¸Ñ‚ÑŒ, Ð¿Ð¾ÑÐºÐ¾Ð»ÑŒÐºÑƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° UPDATE Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¿Ñ€ÐµÐ´Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½ÑƒÑŽ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñƒ.

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð·Ð°Ð¿Ð¸ÑÐ°Ð»Ð° ÑÐ²Ð¾Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð²ÐµÑ€Ñ… Ð¿ÐµÑ€Ð²Ð¾Ð¹. ÐÐ° ÑƒÑ€Ð¾Ð²Ð½Ðµ `Read Committed` ÑÐµÑ€Ð²ÐµÑ€ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‚Ð¸Ñ‚ÑŒ, Ñ‚Ð°Ðº ÐºÐ°Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° `UPDATE` Ñ Ð¿Ñ€ÐµÐ´Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ð¾Ð¹ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¾Ð¹ Ð½Ðµ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ð²Ð°ÐµÑ‚ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚.

---

# Ð˜Ñ‚Ð¾Ð³

* Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ `Read Committed` Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð³Ñ€ÑÐ·Ð½Ð¾Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ, Ð½Ð¾ Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ.
* ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð² PostgreSQL Ð½Ð° ÑÑ‚Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ â€” ÐºÐ¾Ð¼Ð¿Ñ€Ð¾Ð¼Ð¸ÑÑ Ð¼ÐµÐ¶Ð´Ñƒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸ÐµÐ¹ Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒÑŽ.
* ÐŸÑ€Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸ Ð²Ð°Ð¶Ð½Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ Ð¸Ð·Ð¼ÐµÐ½Ñ‡Ð¸Ð²Ð¾ÑÑ‚Ð¸.
* Ð”Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ Ð¾Ñ‚ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¹ Ð½ÑƒÐ¶Ð½Ð° Ð±Ð¾Ð»ÐµÐµ Ð²Ñ‹ÑÐ¾ÐºÐ°Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ñ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `Repeatable Read` Ð¸Ð»Ð¸ `Serializable`.

---


![alt text](image-15.png)


Ð¡Ð¾Ð³Ð»Ð°ÑÐ½Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñƒ, Ð² Ð´Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ðº Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ñ‹Ð¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼ Ð¸ Ð³Ñ€ÑÐ·Ð½Ñ‹Ð¼ Ñ‡Ñ‚ÐµÐ½Ð¸ÑÐ¼ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Repeatable Read Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸ÑŽ, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ð¼Ñ‹ Ð²Ð¸Ð´ÐµÐ»Ð¸, ÐºÐ¾Ð³Ð´Ð° Ñ€Ð°ÑÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ð¸ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Read Committed:

â— ÐÐµÐ¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰ÐµÐµÑÑ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ (non-repeatable read). ÐŸÐ¾ÑÐ»Ðµ Ñ‚Ð¾Ð³Ð¾ ÐºÐ°Ðº Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T1 Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð»Ð° ÑÑ‚Ñ€Ð¾ÐºÑƒ, Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T2 Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð° Ð¸Ð»Ð¸ ÑƒÐ´Ð°Ð»Ð¸Ð»Ð° ÑÑ‚Ñƒ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð¸ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð»Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ (COMMIT). ÐŸÑ€Ð¸ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ð¼ Ñ‡Ñ‚ÐµÐ½Ð¸Ð¸ ÑÑ‚Ð¾Ð¹ Ð¶Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T1 Ð²Ð¸Ð´Ð¸Ñ‚, Ñ‡Ñ‚Ð¾ ÑÑ‚Ñ€Ð¾ÐºÐ° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð° Ð¸Ð»Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°. Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ PostgreSQL Ð±Ð¾Ð»ÐµÐµ ÑÑ‚Ñ€Ð¾Ð³Ð°Ñ, Ñ‡ÐµÐ¼ Ñ‚Ð¾Ð³Ð¾ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚, Ð¸ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸ÑŽ.

â— Ð¤Ð°Ð½Ñ‚Ð¾Ð¼Ð½Ð¾Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ (phantom read). Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T1 Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð»Ð° Ð½Ð°Ð±Ð¾Ñ€ ÑÑ‚Ñ€Ð¾Ðº Ð¿Ð¾ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼Ñƒ ÑƒÑÐ»Ð¾Ð²Ð¸ÑŽ. Ð—Ð°Ñ‚ÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T2 Ð´Ð¾Ð±Ð°Ð²Ð¸Ð»Ð° ÑÑ‚Ñ€Ð¾ÐºÐ¸, Ñ‚Ð°ÐºÐ¶Ðµ ÑƒÐ´Ð¾Ð²Ð»ÐµÑ‚Ð²Ð¾Ñ€ÑÑŽÑ‰Ð¸Ðµ ÑÑ‚Ð¾Ð¼Ñƒ ÑƒÑÐ»Ð¾Ð²Ð¸ÑŽ. Ð•ÑÐ»Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ T1 Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ, Ð¾Ð½Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ Ð´Ñ€ÑƒÐ³ÑƒÑŽ Ð²Ñ‹Ð±Ð¾Ñ€ÐºÑƒ ÑÑ‚Ñ€Ð¾Ðº.

ÐÐ° ÑÐ°Ð¼Ð¾Ð¼ Ð´ÐµÐ»Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‚ Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¸ (Ð½Ðµ Ð¾Ñ‚Ñ€Ð°Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ðµ), ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÑŽÑ‚ÑÑ Ð² PostgreSQL Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Repeatable Read.

ÐžÑ‚ ÑƒÑ€Ð¾Ð²Ð½Ñ Read Committed ÑÑ‚Ð¾Ñ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÐµÑ‚ÑÑ Ð¸ Ñ‚ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð½Ð° Ð½ÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ð±Ð¾Ñ€Ð²Ð°Ð½Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸ÑŽ (Ñ‚Ð°ÐºÑƒÑŽ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ Ð½Ð°Ð´Ð¾ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑ‚ÑŒ). ÐÐ° ÑƒÑ€Ð¾Ð²Ð½Ðµ Read Committed ÑÑ‚Ð¾Ð³Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° â€” ÐµÑÐ»Ð¸ ÑÑ‚Ð¾Ð¸Ñ‚ Ð²Ñ‹Ð±Ð¾Ñ€ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¸ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒÑŽ, Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ Ð²ÑÐµÐ³Ð´Ð° Ð¾Ñ‚Ð´Ð°ÐµÑ‚ÑÑ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸.


## ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ°


# Repeatable Read Ð¸ Ð½ÐµÐ¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰ÐµÐµÑÑ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ

Ð£Ð±ÐµÐ´Ð¸Ð¼ÑÑ Ð² Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¸ Ð½ÐµÐ¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰ÐµÐ³Ð¾ÑÑ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ.

```sql
=> BEGIN ISOLATION LEVEL REPEATABLE READ;
BEGIN

=> SELECT * FROM lights WHERE lamp = 'red';
 id | lamp | state 
----+------+-------
  1 | red  | off
(1 row)

| => UPDATE lights SET state = 'on' WHERE lamp = 'red' RETURNING *;
|  id | lamp | state 
| ----+------+-------
|   1 | red  | on
| (1 row)
| 
| UPDATE 1
````

ÐšÐ°ÐºÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð¿ÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ?

```sql
=> SELECT * FROM lights WHERE lamp = 'red';
 id | lamp | state 
----+------+-------
  1 | red  | off
(1 row)

=> COMMIT;
COMMIT
```

ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¿ÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ.

---

# Repeatable Read Ð¸ Ñ„Ð°Ð½Ñ‚Ð¾Ð¼Ð½Ð¾Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ

Ð¤Ð°Ð½Ñ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ‚Ð°ÐºÐ¶Ðµ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð²Ð¸Ð´Ð½Ñ‹. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼ ÑÑ‚Ð¾.

```sql
=> BEGIN ISOLATION LEVEL REPEATABLE READ;
BEGIN

=> SELECT * FROM lights WHERE state = 'off';
 id | lamp  | state 
----+-------+-------
  2 | green | off
(1 row)

| => INSERT INTO lights(lamp,state) VALUES ('yellow', 'off') 
|     RETURNING *;
|  id |  lamp  | state 
| ----+--------+-------
|   3 | yellow | off
| (1 row)
| 
| INSERT 0 1

=> SELECT * FROM lights WHERE state = 'off';
 id | lamp  | state 
----+-------+-------
  2 | green | off
(1 row)

Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾, Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð½Ðµ Ð²Ð¸Ð´Ð¸Ñ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ð¾Ð¹ Ð·Ð°Ð¿Ð¸ÑÐ¸, ÑƒÐ´Ð¾Ð²Ð»ÐµÑ‚Ð²Ð¾Ñ€ÑÑŽÑ‰ÐµÐ¹ Ð¿ÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ ÑƒÑÐ»Ð¾Ð²Ð¸ÑŽ. Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Repeatable Read Ð² PostgreSQL Ð±Ð¾Ð»ÐµÐµ ÑÑ‚Ñ€Ð¾Ð³Ð¸Ð¹, Ñ‡ÐµÐ¼ Ñ‚Ð¾Ð³Ð¾ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚ SQL.

=> COMMIT;
COMMIT
```

Ð£Ð±ÐµÑ€ÐµÐ¼ Ð¶ÐµÐ»Ñ‚ÑƒÑŽ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÑƒ.

```sql
=> DELETE FROM lights WHERE lamp = 'yellow';
DELETE 1
```

---

# Repeatable Read Ð¸ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ

ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð²ÑÐµ Ð²Ñ€ÐµÐ¼Ñ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ñ€Ð¾Ð²Ð½Ð¾ Ñ‚Ðµ Ð¶Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ñ‡Ñ‚Ð¾ Ð¸ Ð² ÑÐ°Ð¼Ð¾Ð¼ Ð½Ð°Ñ‡Ð°Ð»Ðµ, Ð½Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¿ÐµÑ€ÐµÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð² ÑÐ»ÑƒÑ‡Ð°Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ.

Ð’Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ¼ Ñ‚Ð¾Ñ‚ Ð¶Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¼Ñ‹ Ð²Ð¸Ð´ÐµÐ»Ð¸ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Read Committed. Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð²ÑÐµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹.

```sql
| => BEGIN;
| BEGIN
| 
| => UPDATE lights SET state = 'blink' WHERE lamp = 'red';
| UPDATE 1
| 
| => BEGIN ISOLATION LEVEL REPEATABLE READ;
| BEGIN
| 
| => SELECT state AS current_state FROM lights WHERE lamp = 'red';
|  current_state 
| ---------------
|  on
| (1 row)
| 
| => \bind off
| 
| => UPDATE lights SET state = $1 WHERE lamp = 'red';
```

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¶Ð´ÐµÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿ÐµÑ€Ð²Ð¾Ð¹.

```sql
=> COMMIT;
COMMIT

| ERROR:  could not serialize access due to concurrent update

| => ROLLBACK;
| ROLLBACK
```

Ð¢Ð°ÐºÐ¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼, Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð½Ð¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Repeatable Read Ð½Ðµ Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ.

---

# Repeatable Read Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¸

ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¼ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ Ð²ÑÐµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸?

```sql
UPDATE lights SET state = 'on' WHERE state != 'on';
```

ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¼ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ Ð²ÑÐµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸?

```sql
UPDATE lights SET state = 'off' WHERE state != 'off';
```

Ð•ÑÐ»Ð¸ Ð¾Ð´Ð½Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸, Ð° Ð´Ñ€ÑƒÐ³Ð°Ñ â€” Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚, Ð² ÐºÐ°ÐºÐ¾Ð¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸ Ð¾ÑÑ‚Ð°Ð½ÐµÑ‚ÑÑ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¿Ð¾ÑÐ»Ðµ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð´Ð²ÑƒÑ… ÑÑ‚Ð¸Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹?

Ð’ÐºÐ»ÑŽÑ‡Ð¸Ð¼ ÐºÑ€Ð°ÑÐ½ÑƒÑŽ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÑƒ Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ð¼.

```sql
=> UPDATE lights SET state = 'on' WHERE lamp = 'red';
UPDATE 1
```

ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ:

```sql
=> SELECT * FROM lights ORDER BY id;
 id | lamp  | state 
----+-------+-------
  1 | red   | on
  2 | green | off
(2 rows)

=> BEGIN ISOLATION LEVEL REPEATABLE READ;
BEGIN

=> UPDATE lights SET state = 'on' WHERE state != 'on';
UPDATE 1

=> SELECT * FROM lights ORDER BY id;
 id | lamp  | state 
----+-------+-------
  1 | red   | on
  2 | green | on
(2 rows)

| => BEGIN ISOLATION LEVEL REPEATABLE READ;
| BEGIN

| => UPDATE lights SET state = 'off' WHERE state != 'off';
| UPDATE 1

| => SELECT * FROM lights ORDER BY id;
|  id | lamp  | state 
| ----+-------+-------
|   1 | red   | off
|   2 | green | off
| (2 rows)

=> COMMIT;
COMMIT

| => COMMIT;
| COMMIT
```

Ð˜ Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾...

```sql
=> SELECT * FROM lights ORDER BY id;
 id | lamp  | state 
----+-------+-------
  1 | red   | off
  2 | green | on
(2 rows)
```

...Ð¾Ð´Ð½Ð° Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ° Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°, Ð° Ð´Ñ€ÑƒÐ³Ð°Ñ â€” Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°.

Ð­Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¸ ÐºÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ‚Ð½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° â€” **Ð½ÐµÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ (write skew)**, â€” ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð°, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ Ð³Ñ€ÑÐ·Ð½Ð¾Ð³Ð¾, Ð½ÐµÐ¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰ÐµÐ³Ð¾ÑÑ Ð¸ Ñ„Ð°Ð½Ñ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ Ñ‡Ñ‚ÐµÐ½Ð¸Ð¹.

![alt text](image-16.png)


ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ ÐºÐ°ÐºÐ¸Ñ… Ð±Ñ‹ Ñ‚Ð¾ Ð½Ð¸ Ð±Ñ‹Ð»Ð¾ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¹ Ð´Ð¾ÑÑ‚Ð¸Ð³Ð°ÐµÑ‚ÑÑ, ÐµÑÐ»Ð¸:
> ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹, Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ðµ Ð² ÐºÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ‚Ð½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‰Ð¸Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑÑ…, Ð¿Ñ€Ð¸Ð²Ð¾Ð´ÑÑ‚ Ðº Ñ‚Ð°ÐºÐ¾Ð¼Ñƒ Ð¶Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñƒ, ÐºÐ°ÐºÐ¾Ð¹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»ÑÑ Ð±Ñ‹ Ð² ÑÐ»ÑƒÑ‡Ð°Ðµ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ (Ð¾Ð´Ð½Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»Ð°ÑÑŒ â†’ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ð½Ð°Ñ‡Ð°Ð»Ð°ÑÑŒ) Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑÑ‚Ð¸Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ (Ð¿Ñ€Ð¸ ÐºÐ°ÐºÐ¾Ð¼-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ).

Ð’ PostgreSQL ÑÑ‚Ð¾Ñ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð½Ð¾ **Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð²ÑÐµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Serializable**.

#### ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
1. **ÐÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ…**
   - Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ðµ Ð¼Ð¾Ð³ÑƒÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒÑÑ Ð½Ð° Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ…
2. **Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹ Ð»Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ**
   - Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¾Ð±Ñ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ñ‡Ð°Ñ‰Ðµ, Ñ‡ÐµÐ¼ ÑÑ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾
   - Ð¡Ð½Ð¸Ð¶Ð°ÐµÑ‚ÑÑ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¾Ð±Ð¾Ñ€Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾

## ÐŸÐ ÐÐšÐ¢Ð˜ÐšÐ



# Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Serializable

```sql
-- ÐÐ°Ñ‡Ð°Ð»Ð¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¼ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Serializable
BEGIN ISOLATION LEVEL SERIALIZABLE;

-- ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð²ÑÐµ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸
UPDATE lights SET state = 'on' WHERE state != 'on';
-- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: UPDATE 1

-- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐµÐº Ð² Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
SELECT * FROM lights ORDER BY id;
```
Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸:
```
 id | lamp  | state 
----+-------+-------
  1 | red   | on
  2 | green | on
(2 rows)
```

Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð½Ðµ Ð²Ð¸Ð´Ð¸Ñ‚ Ð½ÐµÐ·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹: Ð´Ð»Ñ Ð½ÐµÐµ ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹ ÑÐ²ÐµÑ‚ ÐµÑ‰Ðµ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½, Ð¸ Ð¾Ð½Ð° Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð·ÐµÐ»ÐµÐ½Ñ‹Ð¹.

```sql
| -- Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ (Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð°Ñ) Ñ‚Ð°ÐºÐ¶Ðµ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ Serializable
| BEGIN ISOLATION LEVEL SERIALIZABLE;
| 
| -- ÐžÐ½Ð° Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸
| UPDATE lights SET state = 'off' WHERE state != 'off';
| -- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: UPDATE 1
| 
| -- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐµÐº Ð²Ð¾ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
| SELECT * FROM lights ORDER BY id;
```
Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸:
Ð”Ð»Ñ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¾Ð±Ðµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹:
```
 id | lamp  | state 
----+-------+-------
  1 | red   | off
  2 | green | off
(2 rows)
```

```sql
-- ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
COMMIT;  -- ÐŸÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑÑ
| COMMIT;  -- Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ
```
ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸:
```
| ERROR:  could not serialize access due to read/write dependencies among transactions
| DETAIL:  Reason code: Canceled on identification as a pivot, during commit attempt.
| HINT:  The transaction might succeed if retried.
 ```

## Ð˜ Ð²Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ.

ÐŸÑ€Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹ Ð´Ð²Ð° Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð°:
1. Ð•ÑÐ»Ð¸ ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð¿ÐµÑ€Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ, Ð° Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð²Ñ‚Ð¾Ñ€Ð°Ñ - Ð²ÑÐµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‚ÑÑ
2. Ð•ÑÐ»Ð¸ ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð²Ñ‚Ð¾Ñ€Ð°Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ, Ð° Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿ÐµÑ€Ð²Ð°Ñ - Ð²ÑÐµ Ð»Ð°Ð¼Ð¿Ð¾Ñ‡ÐºÐ¸ Ð²ÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‚ÑÑ

ÐŸÑ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð½ÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ PostgreSQL Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð¾Ð´Ð½Ñƒ Ð¸Ð· Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹.

## Ð’Ð°Ð¶Ð½Ð¾Ðµ Ð·Ð°Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ

Ð”Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑƒÑ€Ð¾Ð²Ð½Ñ Serializable **Ð²ÑÐµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸** Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸. Ð•ÑÐ»Ð¸ ÑÐ¼ÐµÑˆÐ¸Ð²Ð°Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, Serializable Ð±ÑƒÐ´ÐµÑ‚ Ð²ÐµÑÑ‚Ð¸ ÑÐµÐ±Ñ ÐºÐ°Ðº Repeatable Read.


![alt text](image.png)

ÐŸÐ¾Ð´Ñ‹Ñ‚Ð¾Ð¶Ð¸Ð¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ.

Ð’ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ðµ SQL Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ñ‹ Ñ‡ÐµÑ‚Ñ‹Ñ€Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹:Read Uncommitted, Read Committed, Repeatable Read, Serializable(Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ).

Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¼ÐµÐ¶Ð´Ñƒ ÑƒÑ€Ð¾Ð²Ð½ÑÐ¼Ð¸ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð¸ Ñ‚ÐµÐ¼Ð¸ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸ÑÐ¼Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¾Ð½Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð´Ð¾Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ.ÐžÑ‚Ð¼ÐµÑ‚Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ð´Ð»Ñ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡ÐµÐ½Ð¸Ñ ÑƒÑ€Ð¾Ð²Ð½Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Serializable Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¸ÑÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð¸ Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¸, Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ñ‹Ðµ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ðµ

![alt text](image-1.png)


> Ð ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¡Ð£Ð‘Ð”, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ PostgreSQL, Ð½Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‚ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ñƒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð±ÑƒÐºÐ²Ð°Ð»ÑŒÐ½Ð¾. Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ð»ÑÑ ÐµÑ‰Ñ‘ Ð´Ð¾ Ñ‚Ð¾Ð³Ð¾, ÐºÐ°Ðº Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¸ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ð¾Ðµ Ñ‚ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ.
>
> ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸ÑÑŒ, Ð½Ð¾ **Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð² PostgreSQL Ð·Ð°Ñ‡Ð°ÑÑ‚ÑƒÑŽ ÑÑ‚Ñ€Ð¾Ð¶Ðµ, Ñ‡ÐµÐ¼ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚**.
>
> PostgreSQL Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ **Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸ÑŽ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ ÑÐ½Ð¸Ð¼ÐºÐ¾Ð² (Snapshot Isolation)** Ð¸ **Ð¼Ð½Ð¾Ð³Ð¾Ð²ÐµÑ€ÑÐ¸Ð¾Ð½Ð½Ð¾ÑÑ‚ÑŒ (MVCC)**, Ñ‡Ñ‚Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð°:
>
> * **Ð“Ñ€ÑÐ·Ð½Ð¾Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ (Dirty Read)** Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ â€” Ð¸ ÑÑ‚Ð¾ Ð´Ð¾ÑÑ‚Ð¸Ð³Ð°ÐµÑ‚ÑÑ Ð±ÐµÐ· Ð¿Ð¾Ñ‚ÐµÑ€ÑŒ Ð² Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸.
>
> * **Read Committed** â€” ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ. ÐžÐ½ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð²Ð¾ Ð¼Ð½Ð¾Ð³Ð¸Ñ… Ð¡Ð£Ð‘Ð” Ð¸ Ñ‡Ð°ÑÑ‚Ð¾ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….
>
> * **Repeatable Read** â€” Ð½Ðµ Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð½Ð¸ Ð½ÐµÐ¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÐµÐ¼Ð¾Ð³Ð¾ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ, Ð½Ð¸ Ñ„Ð°Ð½Ñ‚Ð¾Ð¼Ð¾Ð². Ð¥Ð¾Ñ‚Ñ ÑÑ‚Ð¾ Ð½Ðµ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ð°Ñ ÑÐµÑ€Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ, Ð´Ð°Ð½Ð½Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ ÑƒÐ´Ð¾Ð±ÐµÐ½, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð´Ð»Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²: Ð¾Ð½ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ ÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸ ÑÐµÑ€Ð¸Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¸ Ð½Ðµ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾-Ñ‡Ð¸Ñ‚Ð°ÑŽÑ‰Ð¸Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸.
>
> * **Serializable** â€” Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ, Ð½Ð¾ Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ñ‹Ð¼Ð¸ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¸ Ð½Ð°ÐºÐ»Ð°Ð´Ð½Ñ‹Ð¼Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð´Ð°Ð¼Ð¸.
>
> ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ â€” Ð² Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸:
> [https://postgrespro.ru/docs/postgresql/16/transaction-iso](https://postgrespro.ru/docs/postgresql/16/transaction-iso)

---


![alt text](image-2.png)

![alt text](image-3.png)
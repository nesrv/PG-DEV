### üîå –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `lo` –≤ PostgreSQL

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `lo` –¥–æ–±–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ SQL-–æ–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å **–±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏** (`Large Objects`) –≤ PostgreSQL. –û–Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–∞–∫ `lo_create`, `lo_import`, `lo_export`, `lo_open`, `lowrite`, `loread`, –∏ –¥—Ä—É–≥–∏–µ.

---

### üì¶ –ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `lo`

```sql
CREATE EXTENSION lo;
```

> ‚ö†Ô∏è –û–±—ã—á–Ω–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –¢—Ä–µ–±—É—é—Ç—Å—è —Å—É–ø–µ—Ä–ø—Ä–∞–≤–∞ –∏–ª–∏ —Ä–æ–ª—å `CREATEDB`.

---

### üìã –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç `lo`

* –¢–∞–±–ª–∏—Ü–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤:
  **`pg_largeobject`** ‚Äî —Å–∞–º–∏ –¥–∞–Ω–Ω—ã–µ
  **`pg_largeobject_metadata`** ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (OID, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –ø—Ä.)

* –û–±—ë—Ä—Ç–∫–∏:

  | –§—É–Ω–∫—Ü–∏—è                | –û–ø–∏—Å–∞–Ω–∏–µ                           |
  | ---------------------- | ---------------------------------- |
  | `lo_create(oid)`       | –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞          |
  | `lo_unlink(oid)`       | –£–¥–∞–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞          |
  | `lo_import(path)`      | –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ –≤ –ë–î –∫–∞–∫ LOB          |
  | `lo_export(oid, path)` | –≠–∫—Å–ø–æ—Ä—Ç –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤ —Ñ–∞–π–ª    |
  | `lo_open(oid, mode)`   | –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ |
  | `lowrite(fd, bytea)`   | –ó–∞–ø–∏—Å—å –±–∞–π—Ç –≤ –æ–±—ä–µ–∫—Ç               |
  | `loread(fd, size)`     | –ß—Ç–µ–Ω–∏–µ –±–∞–π—Ç –∏–∑ –æ–±—ä–µ–∫—Ç–∞             |
  | `lo_close(fd)`         | –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–±—ä–µ–∫—Ç–∞                   |

---

### üìÇ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `lo_import` / `lo_export`

```sql
-- –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ –≤ –±–∞–∑—É
SELECT lo_import('/tmp/sample.pdf');

-- –≠–∫—Å–ø–æ—Ä—Ç –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å OID 12345)
SELECT lo_export(12345, '/tmp/out.pdf');
```

---

### üîí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `GRANT`/`REVOKE` –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü—ã `pg_largeobject_metadata`, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø–æ–º –∫ LOB'–∞–º.

---

### üìå –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

* –•—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ –∏ —Ç.–ø.
* –£–¥–æ–±–µ–Ω, –∫–æ–≥–¥–∞ –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç—ã `TOAST` (\~1 –ì–ë).

---



# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `lo_import` / `lo_export`

–í–æ—Ç –ø—Ä–∏–º–µ—Ä –Ω–∞ **PL/pgSQL**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `lo` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏, —á—Ç–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (LOB):

---

### ‚úÖ –£—Å–ª–æ–≤–∏–µ

* –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –≤–∞—Å –µ—Å—Ç—å —Ñ–∞–π–ª `/tmp/test_file.txt`, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ –±–∞–∑—É –∫–∞–∫ –±–æ–ª—å—à–æ–π –æ–±—ä–µ–∫—Ç, –ø—Ä–æ—á–∏—Ç–∞—Ç—å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –∞ –∑–∞—Ç–µ–º —É–¥–∞–ª–∏—Ç—å.
* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `lo` —É–∂–µ —Å–æ–∑–¥–∞–Ω–æ:

  ```sql
  CREATE EXTENSION IF NOT EXISTS lo;
  ```

---

### üìÑ –ü—Ä–∏–º–µ—Ä PL/pgSQL-—Ñ—É–Ω–∫—Ü–∏–∏

```sql
DO $$
DECLARE
    lob_oid OID;
    lob_fd INTEGER;
    data BYTEA;
BEGIN
    -- –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ –≤ –±–∞–∑—É –∫–∞–∫ –±–æ–ª—å—à–æ–π –æ–±—ä–µ–∫—Ç
    lob_oid := lo_import('/tmp/test_file.txt');
    RAISE NOTICE 'LOB OID = %', lob_oid;

    -- –û—Ç–∫—Ä—ã–≤–∞–µ–º LOB –¥–ª—è —á—Ç–µ–Ω–∏—è
    lob_fd := lo_open(lob_oid, 262144);  -- 262144 = INV_READ
    RAISE NOTICE 'LOB FD = %', lob_fd;

    -- –ß–∏—Ç–∞–µ–º 1 –ö–ë –¥–∞–Ω–Ω—ã—Ö
    data := loread(lob_fd, 1024);
    RAISE NOTICE 'Data (truncated) = %', convert_from(data, 'UTF8');

    -- –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
    PERFORM lo_close(lob_fd);

    -- –£–¥–∞–ª—è–µ–º LOB –∏–∑ –±–∞–∑—ã
    PERFORM lo_unlink(lob_oid);
    RAISE NOTICE 'LOB % deleted', lob_oid;
END;
$$ LANGUAGE plpgsql;
```

---

### üß† –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

| –®–∞–≥         | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ----------- | ----------------------------------- |
| `lo_import` | –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ OID |
| `lo_open`   | –û—Ç–∫—Ä—ã–≤–∞–µ—Ç LOB –¥–ª—è —á—Ç–µ–Ω–∏—è            |
| `loread`    | –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ LOB                |
| `lo_close`  | –ó–∞–∫—Ä—ã–≤–∞–µ—Ç LOB                       |
| `lo_unlink` | –£–¥–∞–ª—è–µ—Ç LOB –∏–∑ –±–∞–∑—ã                 |

---

# pgAdmin with lo

–†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ (`lo`, Large Objects) –≤ **pgAdmin** –Ω–µ–º–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `psql`, `PL/pgSQL`, –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤—Ä–æ–¥–µ `psycopg2`), –Ω–æ –≤—Å—ë –∂–µ –≤–æ–∑–º–æ–∂–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ **Query Tool**.

---

## üîß –®–∞–≥–∏: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å `lo` –≤ pgAdmin

### 1. üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `lo` (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –±–∞–∑—É)

```sql
CREATE EXTENSION IF NOT EXISTS lo;
```

---

### 2. üì• –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ –≤ LOB

```sql
SELECT lo_import('/absolute/path/to/your/file.txt');
```

üî∏ **–í–∞–∂–Ω–æ:** `lo_import` –∏ `lo_export` —Ä–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ –≤ psql –∏–ª–∏ —Å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏**, –∏ **—Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω PostgreSQL.
–í **pgAdmin** —ç—Ç–æ—Ç –ø—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**, –Ω–µ –Ω–∞ –≤–∞—à–µ–º –∫–ª–∏–µ–Ω—Ç–µ.

–ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –∏–∑ **pgAdmin –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ**, —Ç–æ —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ **—Å–µ—Ä–≤–µ—Ä–µ PostgreSQL**, –Ω–µ –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ.

---

### 3. üßæ –ß—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ LOB

–ß—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å LOB, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `lo_open`, `loread` –∏ —Ç. –¥., –∫–∞–∫ –≤ PL/pgSQL:

```sql
DO $$
DECLARE
    fd integer;
    oid oid := 123456;  -- –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π OID
    data bytea;
BEGIN
    fd := lo_open(oid, 262144); -- INV_READ
    data := loread(fd, 4096);
    RAISE NOTICE 'Data: %', convert_from(data, 'UTF8');
    PERFORM lo_close(fd);
END;
$$ LANGUAGE plpgsql;
```

---

### 4. üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ LOB

```sql
SELECT lo_unlink(123456);  -- –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π OID
```

---

## üß† –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–ø–∏—Å–æ–∫ LOB

```sql
SELECT loid, pg_size_pretty(length(data)) 
FROM pg_largeobject_metadata m
JOIN pg_largeobject l ON l.loid = m.oid
LIMIT 10;
```

---

## üí° –°–æ–≤–µ—Ç—ã

| –ß—Ç–æ                                               | –ö–∞–∫                                                                                                                   |
| ------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| üìç –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è LOB?                              | –í —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `pg_largeobject`                                                                                  |
| üîê –ö—Ç–æ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å lo\_import/lo\_export?    | –¢–æ–ª—å–∫–æ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å                                                                                              |
| üîÑ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞?                   | –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç `psql` –∏–ª–∏ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (Python, Java –∏ –¥—Ä.)                                       |
| üìÅ –ö–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ pgAdmin? | –ù–∏–∫–∞–∫ –Ω–∞–ø—Ä—è–º—É—é ‚Äî pgAdmin –Ω–µ –º–æ–∂–µ—Ç "–≤—ã—Ç—è–Ω—É—Ç—å" —Ñ–∞–π–ª —Å –≤–∞—à–µ–π –º–∞—à–∏–Ω—ã –≤ LOB. –ù—É–∂–Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ (`psql`, —Å–∫—Ä–∏–ø—Ç, API) |

---





## –ú–æ–¥—É–ª—å 8. –†–∞–±–æ—Ç–∞ —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏

- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö –ë–î.
- `Adjacency List` –∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.
- `Materialized Path` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è `ltree`.

---

# üéì –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö –ë–î

---

## üìç –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–†–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –ë–î ‚Äî —Ç–∞–±–ª–∏—á–Ω—ã–µ, –Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ:

* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
* –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
* –ú–µ–Ω—é

–ü–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω—ã **—Å–ø–æ—Å–æ–±—ã –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ—Ä–µ–≤—å–µ–≤** –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö.

---

## üß± 1. **Adjacency List (–°–ø–∏—Å–æ–∫ —Å–º–µ–∂–Ω–æ—Å—Ç–∏)**

## üìå –°—É—Ç—å –ø–æ–¥—Ö–æ–¥–∞

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é —Å—Ç—Ä–æ–∫—É —á–µ—Ä–µ–∑ –ø–æ–ª–µ `parent_id`.

---

## üìò 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    parent_id INT,
    FOREIGN KEY (parent_id) REFERENCES categories(id)
);
```

---

## üì• 2. –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–º–µ—Ä –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)

```sql
-- –ö–æ—Ä–Ω–µ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
INSERT INTO categories (id, name, parent_id) VALUES (1, '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', NULL);
INSERT INTO categories (id, name, parent_id) VALUES (2, '–û–¥–µ–∂–¥–∞', NULL);

-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
INSERT INTO categories (id, name, parent_id) VALUES (3, '–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã', 1);
INSERT INTO categories (id, name, parent_id) VALUES (4, '–ù–æ—É—Ç–±—É–∫–∏', 1);
INSERT INTO categories (id, name, parent_id) VALUES (5, '–ú—É–∂—Å–∫–∞—è –æ–¥–µ–∂–¥–∞', 2);
INSERT INTO categories (id, name, parent_id) VALUES (6, '–ñ–µ–Ω—Å–∫–∞—è –æ–¥–µ–∂–¥–∞', 2);

-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è
INSERT INTO categories (id, name, parent_id) VALUES (7, '–ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏', 4);
```

---

## üîç 3. –ü–æ–ª—É—á–µ–Ω–∏–µ **–ø—Ä—è–º—ã—Ö –ø–æ—Ç–æ–º–∫–æ–≤** —É–∑–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞")

```sql
SELECT * FROM categories
WHERE parent_id = 1;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
id | name        | parent_id
---+-------------+-----------
 3 | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã   |     1
 4 | –ù–æ—É—Ç–±—É–∫–∏    |     1
```

---

## üîÅ 4. –ü–æ–ª—É—á–µ–Ω–∏–µ **–≤—Å–µ—Ö –ø–æ—Ç–æ–º–∫–æ–≤** (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ) ‚Äî PostgreSQL/SQL Server/SQLite 3.8+

```sql
WITH RECURSIVE subcategories AS (
    SELECT * FROM categories WHERE id = 1
    UNION ALL
    SELECT c.* FROM categories c
    JOIN subcategories s ON c.parent_id = s.id
)
SELECT * FROM subcategories;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
id | name              | parent_id
---+-------------------+-----------
 1 | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞       | NULL
 3 | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã         | 1
 4 | –ù–æ—É—Ç–±—É–∫–∏          | 1
 7 | –ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏  | 4
```

---

## üîÅ 5. –ü–æ–ª—É—á–µ–Ω–∏–µ **–≤—Å–µ—Ö –ø—Ä–µ–¥–∫–æ–≤** (–≤–æ—Å—Ö–æ–¥—è—â–µ–µ –¥–µ—Ä–µ–≤–æ) ‚Äî —Ç–∞–∫–∂–µ —á–µ—Ä–µ–∑ —Ä–µ–∫—É—Ä—Å–∏—é

```sql
WITH RECURSIVE ancestors AS (
    SELECT * FROM categories WHERE id = 7
    UNION ALL
    SELECT c.* FROM categories c
    JOIN ancestors a ON c.id = a.parent_id
)
SELECT * FROM ancestors;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
id | name              | parent_id
---+-------------------+-----------
 7 | –ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏  | 4
 4 | –ù–æ—É—Ç–±—É–∫–∏          | 1
 1 | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞       | NULL
```

---

## üå≥ 6. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ (–ø—Ä–∏–º–µ—Ä —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)

```sql
WITH RECURSIVE tree AS (
    SELECT id, name, parent_id, 0 AS level
    FROM categories
    WHERE parent_id IS NULL
    UNION ALL
    SELECT c.id, c.name, c.parent_id, t.level + 1
    FROM categories c
    JOIN tree t ON c.parent_id = t.id
)
SELECT
    LPAD('', level * 4, ' ') || name AS indented_name
FROM tree
ORDER BY level;
```

**–í—ã–≤–æ–¥ (–ø—Ä–∏–º–µ—Ä):**

```
–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
    –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã
    –ù–æ—É—Ç–±—É–∫–∏
        –ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏
–û–¥–µ–∂–¥–∞
    –ú—É–∂—Å–∫–∞—è –æ–¥–µ–∂–¥–∞
    –ñ–µ–Ω—Å–∫–∞—è –æ–¥–µ–∂–¥–∞
```

---

## üß≠ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Adjacency List

### ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç:

| –°—Ü–µ–Ω–∞—Ä–∏–π                                                   | –ü–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç                                                                                                                     |
| ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| **–ü—Ä–æ—Å—Ç–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è**                          | –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤, –º–µ–Ω—é, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.                                         |
| **–†–µ–¥–∫–æ –Ω—É–∂–Ω—ã –≤—Å–µ –ø–æ—Ç–æ–º–∫–∏/–ø—Ä–µ–¥–∫–∏** | –ï—Å–ª–∏ –¥–µ—Ä–µ–≤–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è "—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å" —Ü–µ–ª–∏–∫–æ–º ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–µ–π. |
| **–ß–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É**    | –£–¥–∞–ª—è—Ç—å/–ø–µ—Ä–µ–º–µ—â–∞—Ç—å —É–∑–ª—ã –ª–µ–≥–∫–æ ‚Äî –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º `parent_id`.                                               |
| **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –°–£–ë–î —Å —Ä–µ–∫—É—Ä—Å–∏–µ–π**  | –ù–∞–ø—Ä–∏–º–µ—Ä, PostgreSQL, SQL Server, SQLite 3.8+, MySQL 8.0+ ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.              |
| **–•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å ORM**                     | –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ Django, SQLAlchemy, Hibernate ‚Äî –ª–µ–≥–∫–æ –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `ForeignKey`.                                  |

---

### ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç:

| –°—Ü–µ–Ω–∞—Ä–∏–π                                                                                            | –ü–æ—á–µ–º—É –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç                                               |
| ----------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| **–ì–ª—É–±–æ–∫–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —É—Ä–æ–≤–Ω–µ–π**                          | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏. |
| **–ù—É–∂–Ω–æ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –≤—Å—ë –¥–µ—Ä–µ–≤–æ –∏–ª–∏ –≤—Å–µ—Ö –ø–æ—Ç–æ–º–∫–æ–≤** | –ù—É–∂–Ω—ã CTE-–∑–∞–ø—Ä–æ—Å—ã (–∏–ª–∏ –æ–±—Ö–æ–¥ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ).           |
| **–ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ —á–∞—Å—Ç–æ —á–∏—Ç–∞–µ—Ç—Å—è**                    | –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Nested Set –∏–ª–∏ Closure Table.             |

---

## üì¶ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

### 1. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞**

* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –ü–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
* –£ –∫–∞–∂–¥–æ–π –µ—Å—Ç—å `parent_id`.
* –ù–∞–ø—Ä–∏–º–µ—Ä: `–¢–µ–ª–µ—Ñ–æ–Ω—ã ‚Üí –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã ‚Üí Android`.

### 2. **–ú–µ–Ω—é —Å–∞–π—Ç–∞**

* `–ì–ª–∞–≤–Ω–∞—è`, `–û –Ω–∞—Å`, `–£—Å–ª—É–≥–∏ ‚Üí –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –í–µ–±` –∏ —Ç.–ø.
* –ü–æ–¥—Ö–æ–¥–∏—Ç, —Ç.–∫. –ª–µ–≥–∫–æ —Å—Ç—Ä–æ–∏—Ç—å –¥–µ—Ä–µ–≤–æ –º–µ–Ω—é.

### 3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**

* –î–∏—Ä–µ–∫—Ç–æ—Ä ‚Üí –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ ‚Üí –°–æ—Ç—Ä—É–¥–Ω–∏–∫.
* –£ –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—Å—Ç—å `manager_id`.

### 4. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–¥–∏—Å–∫—É—Å—Å–∏–∏)**

* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ –¥—Ä—É–≥–æ–π.
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–æ—Ä—É–º–∞—Ö, –±–ª–æ–≥–∞—Ö, —Å–æ—Ü—Å–µ—Ç—è—Ö.

---

## üß† –ì–ª–∞–≤–Ω–æ–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å:

**Adjacency List** ‚Äî —ç—Ç–æ **—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –≥–∏–±–∫–∏–π —Å–ø–æ—Å–æ–±** —Ö—Ä–∞–Ω–∏—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏:

* –¥–µ—Ä–µ–≤–æ –Ω–µ–≥–ª—É–±–æ–∫–æ–µ,
* —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è,
* —É –Ω–∞—Å –µ—Å—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ CTE –≤ SQL.

---

## 2. üìå –ß—Ç–æ —Ç–∞–∫–æ–µ Materialized Path?

**Materialized Path** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏, –≤ –∫–æ—Ç–æ—Ä–æ–º –∫–∞–∂–¥—ã–π —É–∑–µ–ª —Ö—Ä–∞–Ω–∏—Ç **–ø–æ–ª–Ω—ã–π –ø—É—Ç—å –æ—Ç –∫–æ—Ä–Ω—è –¥–æ —Å–µ–±—è**, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞, –º–∞—Å—Å–∏–≤ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø.

–ù–∞–ø—Ä–∏–º–µ—Ä, –ø—É—Ç—å –∫ —É–∑–ª—É "–ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏" –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
1.2.4.5
```

–ì–¥–µ:

* `1` ‚Äî –∫–æ—Ä–µ–Ω—å (–ö–∞—Ç–µ–≥–æ—Ä–∏–∏)
* `2` ‚Äî –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
* `4` ‚Äî –ù–æ—É—Ç–±—É–∫–∏
* `5` ‚Äî –ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏

---

## üìò –ö–∞–∫ —ç—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è

### –ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY,
    name TEXT,
    path TEXT  -- –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å
);
```

| id | name                            | path    |
| -- | ------------------------------- | ------- |
| 1  | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏              | 1       |
| 2  | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞          | 1.2     |
| 3  | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã              | 1.2.3   |
| 4  | –ù–æ—É—Ç–±—É–∫–∏                | 1.2.4   |
| 5  | –ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏ | 1.2.4.5 |

---

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ `ltree`?

`ltree` ‚Äî —ç—Ç–æ **—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–∏—Å–∫–∞ **–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π**.

üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:

```sql
CREATE EXTENSION ltree;
```

### –¢–∞–±–ª–∏—Ü–∞ —Å `ltree`:

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY,
    name TEXT,
    path LTREE
);
```

| id | name                   | path  |
| -- | ---------------------- | ----- |
| 1  | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏     | 1     |
| 2  | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ | 1.2   |
| 3  | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã     | 1.2.3 |

---

## üîç –ü–æ–∏—Å–∫ —Å `ltree`

`ltree` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–µ—Ä–∞—Ä—Ö–∏—è–º–∏**, –æ—á–µ–Ω—å —É–¥–æ–±–Ω—ã–µ:

### üîΩ –ü–æ—Ç–æ–º–∫–∏:

```sql
SELECT * FROM categories
WHERE path <@ '1.2';
```

`<@` ‚Äî –æ–∑–Ω–∞—á–∞–µ—Ç ¬´—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Ç–æ–º–∫–æ–º –∏–ª–∏ —Ä–∞–≤–µ–Ω¬ª

### üîº –ü—Ä–µ–¥–∫–∏:

```sql
SELECT * FROM categories
WHERE path @> '1.2.3';
```

`@>` ‚Äî –æ–∑–Ω–∞—á–∞–µ—Ç ¬´—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥–∫–æ–º¬ª

### üîç –ü–æ–∏—Å–∫ —Å –º–∞—Å–∫–æ–π:

```sql
SELECT * FROM categories
WHERE path ~ '1.*{1,2}';  -- –ø–æ—Ç–æ–º–∫–∏ –Ω–∞ 1‚Äì2 —É—Ä–æ–≤–Ω—è –≥–ª—É–±–∂–µ
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `Materialized Path` + `ltree`

| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ                          |  |  | –ü–æ—á–µ–º—É —ç—Ç–æ —É–¥–æ–±–Ω–æ                             |
| ------------------------------------------------- | - | - | ------------------------------------------------------------ |
| –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫              |  |  | –ò–Ω–¥–µ–∫—Å GIST/GIN –ø–æ `ltree`                         |
| –ü—Ä–æ—Å—Ç–∞—è –≤—Å—Ç–∞–≤–∫–∞ —É–∑–ª–æ–≤          |  |  | –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—à—å `path`                   |
| –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤                 |  |  | –ë–µ–∑ JOIN, –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏                         |
| –ì–∏–±–∫–æ—Å—Ç—å                                  |  |  | –ú–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—á—ë—Ç—ã, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é |
| –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ PostgreSQL |  |  | –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å—ã, —Ñ—É–Ω–∫—Ü–∏–∏, —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö |

---

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

| –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫                                           | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                        |
| -------------------------------------------------------------- | ------------------------------------------------------------- |
| –¢—Ä–µ–±—É–µ—Ç—Å—è PostgreSQL                                  | –í MySQL –∏ –¥—Ä. ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫—É     |
| –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ | –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å path —É –≤—Å–µ—Ö –ø–æ—Ç–æ–º–∫–æ–≤ |
| –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ ORM –Ω–∞–ø—Ä—è–º—É—é      | –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω—ã SQL-–∑–∞–ø—Ä–æ—Å—ã –≤—Ä—É—á–Ω—É—é     |

---

## üß∞ –ò–Ω–¥–µ–∫—Å—ã

–ß—Ç–æ–±—ã `ltree` —Ä–∞–±–æ—Ç–∞–ª –±—ã—Å—Ç—Ä–æ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å:

```sql
CREATE INDEX idx_path ON categories USING GIST (path);
```

---

## üèó –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞

–ü—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤–ª—è–µ–º "–ü–ª–∞–Ω—à–µ—Ç—ã" –≤ "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" (`1.2`):

```sql
INSERT INTO categories (id, name, path)
VALUES (6, '–ü–ª–∞–Ω—à–µ—Ç—ã', '1.2.6'::ltree);
```

–ò–ª–∏ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏:

```sql
INSERT INTO categories (id, name, path)
SELECT 6, '–ü–ª–∞–Ω—à–µ—Ç—ã', path || '6'
FROM categories
WHERE id = 2;
```

---

## üìä –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –°—Ü–µ–Ω–∞—Ä–∏–π                         | –ü–æ–¥—Ö–æ–¥–∏—Ç?       |
| ---------------------------------------- | ----------------------- |
| PostgreSQL                               | ‚úÖ                      |
| –ß–∞—Å—Ç–æ —á–∏—Ç–∞–µ–º –¥–µ—Ä–µ–≤–æ     | ‚úÖ                      |
| –ò—â–µ–º –ø–æ—Ç–æ–º–∫–æ–≤/–ø—Ä–µ–¥–∫–æ–≤ | ‚úÖ                      |
| –ß–∞—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–∞–µ–º —É–∑–ª—ã | ‚ö†Ô∏è (–Ω–µ—É–¥–æ–±–Ω–æ) |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ORM –∫—Ä–∏—Ç–∏—á–Ω–∞  | ‚ùå                      |

---

## üîö –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Materialized Path** —Å `ltree` ‚Äî —ç—Ç–æ:

* üí° –ü—Ä–æ—Å—Ç–æ–π –∏ –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ä–µ–≤—å—è
* üöÄ –°—É–ø–µ—Ä—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è
* üß© –•–æ—Ä–æ—à–æ —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
* üìå –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è PostgreSQL-–ø—Ä–æ–µ–∫—Ç–æ–≤

## üßÆ 3. **Nested Set (–í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞)**

---

## üìå –ß—Ç–æ —Ç–∞–∫–æ–µ Nested Set?

**Nested Set** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —É –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –µ—Å—Ç—å –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è:
üîπ `lft` (–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
üî∏ `rgt` (–ø—Ä–∞–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

–≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –ø–æ–ª–æ–∂–µ–Ω–∏–µ —É–∑–ª–∞ **–≤ –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ**, –µ—Å–ª–∏ –µ–µ "—Ä–∞–∑–ª–æ–∂–∏—Ç—å" –ø–æ –≥–ª—É–±–∏–Ω–µ ‚Äî –∫–∞–∫ —Å–∫–æ–±–∫–∏ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏.

---

## üå≥ –ü—Ä–∏–º–µ—Ä –¥–µ—Ä–µ–≤–∞:

```
1. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (lft=1, rgt=14)
    ‚îú‚îÄ‚îÄ 2. –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ (2, 9)
    ‚îÇ     ‚îú‚îÄ‚îÄ 3. –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã (3, 4)
    ‚îÇ     ‚îî‚îÄ‚îÄ 4. –ù–æ—É—Ç–±—É–∫–∏ (5, 8)
    ‚îÇ           ‚îî‚îÄ‚îÄ 5. –ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏ (6, 7)
    ‚îî‚îÄ‚îÄ 6. –û–¥–µ–∂–¥–∞ (10, 13)
          ‚îú‚îÄ‚îÄ 7. –ú—É–∂—Å–∫–∞—è (11, 12)
```

---

## üìã –¢–∞–±–ª–∏—Ü–∞

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    lft INT NOT NULL,
    rgt INT NOT NULL
);
```

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**

| id | name                            | lft | rgt |
| -- | ------------------------------- | --- | --- |
| 1  | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏              | 1   | 14  |
| 2  | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞          | 2   | 9   |
| 3  | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã              | 3   | 4   |
| 4  | –ù–æ—É—Ç–±—É–∫–∏                | 5   | 8   |
| 5  | –ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏ | 6   | 7   |
| 6  | –û–¥–µ–∂–¥–∞                    | 10  | 13  |
| 7  | –ú—É–∂—Å–∫–∞—è                  | 11  | 12  |

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ö–∞–∂–¥–æ–º—É —É–∑–ª—É –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –ª–µ–≤—ã–µ –∏ –ø—Ä–∞–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∞–∫, —á—Ç–æ:

* –ó–Ω–∞—á–µ–Ω–∏—è **–≤—Å–µ–≥–¥–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã**.
* –£ **—Ä–æ–¥–∏—Ç–µ–ª—è**: `lft < lft_–¥–æ—á–µ—Ä–Ω–µ–≥–æ` –∏ `rgt > rgt_–¥–æ—á–µ—Ä–Ω–µ–≥–æ`
* –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–º–∫–æ–≤ = `(rgt - lft - 1) / 2`

---

## ‚úÖ –ß—Ç–æ –ª–µ–≥–∫–æ –¥–µ–ª–∞—Ç—å

### üîΩ –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–æ—Ç–æ–º–∫–æ–≤ —É–∑–ª–∞:

```sql
SELECT * FROM categories
WHERE lft > 2 AND rgt < 9;  -- –ø–æ—Ç–æ–º–∫–∏ "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞"
```

### üîº –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥–∫–æ–≤ —É–∑–ª–∞:

```sql
SELECT * FROM categories
WHERE lft < 6 AND rgt > 7;  -- –ø—Ä–µ–¥–∫–∏ "–ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏"
```

### üìä –£–∑–Ω–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å —É–∑–ª–∞:

–°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥—ë–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–∫–æ–≤:

```sql
SELECT COUNT(*) AS depth
FROM categories AS parent
WHERE 6 BETWEEN parent.lft AND parent.rgt;
```

(–¥–ª—è —É–∑–ª–∞ —Å `lft = 6`, `rgt = 7`)

---

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

* ‚ùó **–°–ª–æ–∂–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ** ‚Äî –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å `lft/rgt` —É –º–Ω–æ–≥–∏—Ö —É–∑–ª–æ–≤.
* –ù–µ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.
* –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞—Ç–∏–≤–Ω–æ –≤ ORM.

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

* üöÄ **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ**:

  * –ü–æ—Ç–æ–º–∫–∏, –ø—Ä–µ–¥–∫–∏, –ø–æ–¥–¥–µ—Ä–µ–≤–æ ‚Äî –≤—Å—ë –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏.
* –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **–∏–µ—Ä–∞—Ä—Ö–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è**, –Ω–æ —á–∞—Å—Ç–æ —á–∏—Ç–∞—é—Ç—Å—è.

---

## üìå –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –°—Ü–µ–Ω–∞—Ä–∏–π                                     | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? |
| ---------------------------------------------------- | ------------------------- |
| –ú–Ω–æ–≥–æ —á—Ç–µ–Ω–∏–π, –º–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π | ‚úÖ –î–∞                   |
| –ß–∞—Å—Ç—ã–µ –≤—Å—Ç–∞–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è         | ‚ùå –ù–µ—Ç                 |
| –¢—Ä–µ–±—É–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ–µ –¥–µ—Ä–µ–≤–æ       | ‚úÖ –î–∞                   |

---

## üîó 4. **Closure Table (–¢–∞–±–ª–∏—Ü–∞ –∑–∞–º—ã–∫–∞–Ω–∏–π)**

üîπ –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –ø–∞—Ä—ã ¬´–ø—Ä–µ–¥–æ–∫‚Äì–ø–æ—Ç–æ–º–æ–∫¬ª –∏ –≥–ª—É–±–∏–Ω—É.

**Closure Table** ‚Äî —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è **—è–≤–Ω–æ —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ —Å–≤—è–∑–∏ –ø—Ä–µ–¥–æ–∫ ‚Üí –ø–æ—Ç–æ–º–æ–∫** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –¥–µ—Ä–µ–≤–∞.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

| –ø—Ä–µ–¥–æ–∫ | –ø–æ—Ç–æ–º–æ–∫ | –≥–ª—É–±–∏–Ω–∞ |
| ------------ | -------------- | -------------- |
| ancestor     | descendant     | depth          |
| --------     | ----------     | -----          |
| 1            | 1              | 0              |
| 1            | 2              | 1              |
| 1            | 3              | 2              |
| 2            | 2              | 0              |
| 2            | 3              | 1              |
| 3            | 3              | 0              |

üî∏ `depth = 0` –æ–∑–Ω–∞—á–∞–µ—Ç "—Å–∞–º —Å–µ–±–µ –ø—Ä–µ–¥–æ–∫"
üî∏ `depth = 1` ‚Äî –ø—Ä—è–º–æ–π –ø–æ—Ç–æ–º–æ–∫
üî∏ `depth > 1` ‚Äî –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏

---

## üìã –ü—Ä–∏–º–µ—Ä

### –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `categories`:

| id | name                   |
| -- | ---------------------- |
| 1  | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏     |
| 2  | –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ |
| 3  | –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã     |

### –¢–∞–±–ª–∏—Ü–∞ –∑–∞–º—ã–∫–∞–Ω–∏–π `category_closure`:

| ancestor | descendant | depth |
| -------- | ---------- | ----- |
| 1        | 1          | 0     |
| 1        | 2          | 1     |
| 1        | 3          | 2     |
| 2        | 2          | 0     |
| 2        | 3          | 1     |
| 3        | 3          | 0     |

---

## üß† –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–ü–∞—Ç—Ç–µ—Ä–Ω —Ä–µ—à–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É:
üîç **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å–µ—Ö –ø—Ä–µ–¥–∫–æ–≤ –∏ –ø–æ—Ç–æ–º–∫–æ–≤ –ª—é–±–æ–≥–æ —É–∑–ª–∞, –Ω–∞ –ª—é–±–æ–º —É—Ä–æ–≤–Ω–µ**, –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏ –∏–ª–∏ –æ–±—Ö–æ–¥–æ–≤.

---

## üìä –¢–∏–ø–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY,
    name TEXT
);

CREATE TABLE category_closure (
    ancestor INT NOT NULL,
    descendant INT NOT NULL,
    depth INT NOT NULL,
    PRIMARY KEY (ancestor, descendant),
    FOREIGN KEY (ancestor) REFERENCES categories(id),
    FOREIGN KEY (descendant) REFERENCES categories(id)
);
```

---

## üîç –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### üîΩ –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–æ—Ç–æ–º–∫–æ–≤ —É–∑–ª–∞:

```sql
SELECT c.*
FROM category_closure cc
JOIN categories c ON c.id = cc.descendant
WHERE cc.ancestor = 1 AND cc.depth > 0;
```

### üîº –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥–∫–æ–≤ —É–∑–ª–∞:

```sql
SELECT c.*
FROM category_closure cc
JOIN categories c ON c.id = cc.ancestor
WHERE cc.descendant = 3 AND cc.depth > 0;
```

### üìê –£–∑–Ω–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å (–≥–ª—É–±–∏–Ω—É):

```sql
SELECT depth
FROM category_closure
WHERE ancestor = 1 AND descendant = 3;
-- depth = 2
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ                                           | –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ                                                   |
| ------------------------------------------------------------------ | ------------------------------------------------------------------------- |
| –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø—Ä–µ–¥–∫–æ–≤/–ø–æ—Ç–æ–º–∫–æ–≤ | –ë–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–π, JOIN-–æ–º –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ |
| –õ—é–±–∞—è –≥–ª—É–±–∏–Ω–∞                                          | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞—Ç–∏–≤–Ω–æ                               |
| –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –°–£–ë–î                            | –ë–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–∫—É—Ä—Å–∏–∏ –∏–ª–∏ –º–∞—Å—Å–∏–≤–æ–≤        |
| –£–¥–æ–±–Ω–æ —Å—á–∏—Ç–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å/–≥–ª—É–±–∏–Ω—É          | depth —É–∂–µ –µ—Å—Ç—å                                                     |

---

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

| –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫                                     | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                                                               |
| -------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö           | –ü—Ä–∏ N —É–∑–ª–∞—Ö ‚Äî –¥–æ O(N¬≤) –∑–∞–ø–∏—Å–µ–π                                                    |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π                  | –ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ/—É–¥–∞–ª–µ–Ω–∏–∏ —É–∑–ª–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å closure-—Ç–∞–±–ª–∏—Ü—É |
| –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ | –í—Å—Ç–∞–≤–∫–∞ = –¥–æ–±–∞–≤–∏—Ç—å –ø—É—Ç–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥–∫–æ–≤                                   |

---

## üß∞ –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –°—Ü–µ–Ω–∞—Ä–∏–π                                    | Closure Table ‚Äî –ü–æ–¥—Ö–æ–¥–∏—Ç?       |
| --------------------------------------------------- | ---------------------------------------- |
| –ë–æ–ª—å—à–∏–µ –¥–µ—Ä–µ–≤—å—è                       | ‚úÖ                                       |
| –ì–ª—É–±–æ–∫–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏             | ‚úÖ                                       |
| –ß–∞—Å—Ç–æ –∏—â–µ–º –ø—Ä–µ–¥–∫–æ–≤/–ø–æ—Ç–æ–º–∫–æ–≤ | ‚úÖ                                       |
| –ß–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞      | ‚ö†Ô∏è (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å—á—ë—Ç–∞) |
| –í–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è            | ‚úÖ                                       |

---

## üèó –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å —É–∑–µ–ª

–î–æ–ø—É—Å—Ç–∏–º, –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π —É–∑–µ–ª `4`, –ø–æ—Ç–æ–º–æ–∫ —É–∑–ª–∞ `2`. –í–∞–º –Ω—É–∂–Ω–æ:

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
INSERT INTO categories (id, name) VALUES (4, '–ü–ª–∞–Ω—à–µ—Ç—ã');

-- –î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑–∏ –≤ closure table:
INSERT INTO category_closure (ancestor, descendant, depth)
SELECT ancestor, 4, depth + 1
FROM category_closure
WHERE descendant = 2

UNION ALL
SELECT 4, 4, 0;
```

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Closure Table**:

* –ì–∏–±–∫–∏–π –∏ –º–æ—â–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è **—á—Ç–µ–Ω–∏—è** –∏–µ—Ä–∞—Ä—Ö–∏–π –ª—é–±–æ–π –≥–ª—É–±–∏–Ω—ã.
* –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **–∞–Ω–∞–ª–∏—Ç–∏–∫–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –æ—Ç—á–µ—Ç–æ–≤**.
* –ò–¥–µ–∞–ª–µ–Ω, –µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ **—Å—Ç–∞–±–∏–ª—å–Ω–∞**, –Ω–æ –≤–∞–∂–Ω–æ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–æ—Å—Ç–∞–≤–∞—Ç—å –ª—é–±—ã–µ —Å–≤—è–∑–∏**.

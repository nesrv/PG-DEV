![alt text](image.png)

## –ú–æ–¥—É–ª—å 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
- –Ø–∑—ã–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä –≤ PostgreSQL.
- –§—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–∞ SQL.
- –Ø–∑—ã–∫ PlPgSQL.
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ –Ω–µ–Ω–∞—Ç–∏–≤–Ω—ã—Ö —è–∑—ã–∫–∞—Ö.



![alt text](image-1.png)

![alt text](image-2.png)


### üìò **–û —Ñ—É–Ω–∫—Ü–∏—è—Ö –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ –≤ PostgreSQL**

#### üéØ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π**

–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ ‚Äî **—É–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏** –ø—É—Ç—ë–º –µ—ë **–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏** –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* –†–∞–±–æ—Ç–∞—Ç—å —Å –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π **–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ**, –Ω–µ –ø–æ–≥—Ä—É–∂–∞—è—Å—å –≤ –¥–µ—Ç–∞–ª–∏ –µ—ë —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
* –°–∫—Ä—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ **—á—ë—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º** (–≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).
* –ò–∑–º–µ–Ω—è—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–∏ **–±–µ–∑ –≤–ª–∏—è–Ω–∏—è** –Ω–∞ –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥.

> –û–¥–Ω–∞–∫–æ —ç—Ç–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Ä—É—à–µ–Ω–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ **–≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**, –∫–æ—Ç–æ—Ä–æ–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å.
> –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –°–£–ë–î —Ç–∞–∫–∏–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è **–≤—Å—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**.

---

#### üì¶ **–ú–æ–¥—É–ª–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞**

–í —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –≤ **–º–æ–¥—É–ª–∏** (–ø–∞–∫–µ—Ç—ã, –∫–ª–∞—Å—Å—ã –∏ —Ç. –¥.), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥,
* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏,
* –í—ã–¥–µ–ª—è—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–¥—É–ª—è.

> –í PostgreSQL —Ç–∞–∫–æ–π –º–æ–¥—É–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã **–Ω–µ—Ç**.
> –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ **–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º—ë–Ω** (schemas), –∞ –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–æ–¥–æ–º —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞:

* **–°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–¥** (—Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–æ—Ü–µ–¥—É—Ä—ã) —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö;
* **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥** —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã.

---

#### ‚öôÔ∏è **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**

–í –æ–±—ã—á–Ω—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã–º –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–º —à–∏—Ä–æ–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –º–æ–≥—É—Ç –±—ã—Ç—å **–Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –≤—ã–∑–æ–≤**.
–û–±—ã—á–Ω–æ —ç—Ç–æ —Ä–µ—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ–¥–∞** —Ñ—É–Ω–∫—Ü–∏–∏ (inlining).

> –í —Å–∏—Å—Ç–µ–º–∞—Ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ PostgreSQL, –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Å–µ—Ä—å—ë–∑–Ω–µ–µ:

* –ü—Ä–∏ –≤—ã–Ω–æ—Å–µ —á–∞—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é **–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä —Ç–µ—Ä—è–µ—Ç "–∫–æ–Ω—Ç–µ–∫—Å—Ç"** –∏ –Ω–µ –º–æ–∂–µ—Ç –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
* –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **—É—Ö—É–¥—à–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**.

üîÑ –û–¥–Ω–∞–∫–æ PostgreSQL —É–º–µ–µ—Ç –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –≤—ã–ø–æ–ª–Ω—è—Ç—å **inlining —Ñ—É–Ω–∫—Ü–∏–π**, –æ—Å–æ–±–µ–Ω–Ω–æ **SQL-—Ñ—É–Ω–∫—Ü–∏–π**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Ç–µ—Ä—å.

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **–ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤** (inline),
* –°–æ–∑–¥–∞–Ω–∏–µ **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π** (views),
* –ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç—å—é.

---

#### üìå **–í—ã–≤–æ–¥**

–§—É–Ω–∫—Ü–∏–∏ ‚Äî –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ –∫–∞–∫ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏, —Ç–∞–∫ –∏ –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö.
–û–¥–Ω–∞–∫–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –≤ PostgreSQL –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–∏—Ç—ã–≤–∞—Ç—å:

* –ñ—ë—Å—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏;
* –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –º–æ–¥—É–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã;
* –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–∑-–∑–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞;
* –°–ø–æ—Å–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —ç—Ç–∏—Ö –ø–æ—Ç–µ—Ä—å ‚Äî –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞, –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

---


![alt text](image-3.png)




## üìå **–§—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL**

### üì¶ **–§—É–Ω–∫—Ü–∏–∏ ‚Äî –ø–æ–ª–Ω–æ–ø—Ä–∞–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –ë–î**

* –§—É–Ω–∫—Ü–∏–∏ –≤ PostgreSQL —è–≤–ª—è—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ –æ–±—ä–µ–∫—Ç–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫ **—Ç–∞–±–ª–∏—Ü—ã**, **–∏–Ω–¥–µ–∫—Å—ã**, **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è** –∏ –¥—Ä.
* –ò—Ö **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ**, –ø–æ—ç—Ç–æ–º—É —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–∑—ã–≤–∞—é—Ç **—Ö—Ä–∞–Ω–∏–º—ã–º–∏** (stored functions).
* –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### üìö **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**

* –í PostgreSQL –≤—Å—Ç—Ä–æ–µ–Ω–æ **–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å:

  * –ß–∏—Å–ª–∞–º–∏, —Å—Ç—Ä–æ–∫–∞–º–∏, –¥–∞—Ç–∞–º–∏,
  * JSON, –º–∞—Å—Å–∏–≤–∞–º–∏ –∏ –¥—Ä.

* –°–ø–∏—Å–æ–∫ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
  [–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–∏](https://postgrespro.ru/docs/postgresql/16/functions)

* –¢–∞–∫–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç **—Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

  * –ù–∞ **—Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö** (SQL, PL/pgSQL, PL/Python –∏ –¥—Ä.).
  * –í —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞ –ø—Ä–∏–º–µ—Ä—ã –¥–∞—é—Ç—Å—è –Ω–∞ **—è–∑—ã–∫–µ SQL**.

---

### üß± **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏**

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∫–ª—é—á–∞–µ—Ç:

1. **–ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏**;
2. **–°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π);
3. **–¢–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è**;
4. **–¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî –∫–æ–¥, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ª–æ–≥–∏–∫—É.

–ü—Ä–∏–º–µ—Ä –Ω–∞ SQL:

```sql
CREATE FUNCTION add(a INT, b INT)
RETURNS INT
AS $$
  SELECT a + b;
$$ LANGUAGE sql;
```

---

### üî§ **–¢–µ–ª–æ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞**

* –ö–æ–¥ —Ç–µ–ª–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–∞–∫ **—Å—Ç—Ä–æ–∫–æ–≤–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞**.
* –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç PostgreSQL —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–¥ **—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ** ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.
* –ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏—è **–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è** –∑–∞–Ω–æ–≤–æ (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π).

---

### ‚öôÔ∏è **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä SQL-—Ñ—É–Ω–∫—Ü–∏–π**

* –ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ **PostgreSQL 14**, –ø–æ—è–≤–∏–ª–∞—Å—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **—Ä–∞–∑–±–∏—Ä–∞—Ç—å SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—Ä–∞–Ω–µ–µ**:

  * –í —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è **–¥–µ—Ä–µ–≤–æ —Ä–∞–∑–±–æ—Ä–∞**, –∞ –Ω–µ –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç.
  * –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**, —É—Å—Ç—Ä–∞–Ω—è—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ.

> –§—É–Ω–∫—Ü–∏–∏ –Ω–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, PL/pgSQL) –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ.

---

### üß† **–§—É–Ω–∫—Ü–∏–∏ –Ω–∞ —è–∑—ã–∫–µ C**

* –ï—â—ë –æ–¥–∏–Ω —Å–ø–æ—Å–æ–± –∏–∑–±–µ–∂–∞—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ ‚Äî –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ —è–∑—ã–∫–µ **C** –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ—ë –∫–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.
* –¢–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é –≤ –Ω–∞—Ç–∏–≤–Ω–æ–º –∫–æ–¥–µ** –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ.
* –û–¥–Ω–∞–∫–æ —ç—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ –¥–∞–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞.

---

### üìç **–ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π**

–§—É–Ω–∫—Ü–∏–∏ –≤ PostgreSQL –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã:

* –í –∫–æ–º–∞–Ω–¥–µ `SELECT` ‚Äî –≤ —Å–ø–∏—Å–∫–µ –≤—ã–±–∏—Ä–∞–µ–º—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π:

  ```sql
  SELECT add(2, 3);
  ```
* –í —É—Å–ª–æ–≤–∏—è—Ö `WHERE`, `HAVING`:

  ```sql
  SELECT * FROM orders WHERE total_with_tax(price) > 1000;
  ```
* –í –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö (`CHECK`):

  ```sql
  CREATE TABLE t (
    x INT CHECK (is_valid_x(x))
  );
  ```

–§—É–Ω–∫—Ü–∏—è ‚Äî —ç—Ç–æ **–≤—ã—Ä–∞–∂–µ–Ω–∏–µ**, –∏ –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ, –≥–¥–µ –¥–æ–ø—É—Å—Ç–∏–º—ã –≤—ã—Ä–∞–∂–µ–Ω–∏—è SQL.

---

### üìñ **–°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

* [SQL: CREATE FUNCTION](https://postgrespro.ru/docs/postgresql/16/sql-createfunction)
* [–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π](https://postgrespro.ru/docs/postgresql/16/sql-syntax-calling-funcs)

---


–í–æ—Ç –≤–∞—à –º–∞—Ç–µ—Ä–∏–∞–ª, –ø–æ–ª–Ω–æ—Å—Ç—å—é **—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π**, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ **Markdown** –∏ **SQL** —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π.

---


# –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–í–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π –æ–¥–∏–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä:

```sql
=> CREATE FUNCTION hello_world() -- –∏–º—è –∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
RETURNS text                     -- —Ç–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
AS $$ SELECT 'Hello, world!'; $$ -- —Ç–µ–ª–æ
LANGUAGE sql;                    -- —É–∫–∞–∑–∞–Ω–∏–µ —è–∑—ã–∫–∞
CREATE FUNCTION
````

–¢–µ–ª–æ —É–¥–æ–±–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ —Å—Ç—Ä–æ–∫–µ, –∑–∞–∫–ª—é—á–µ–Ω–Ω–æ–π –≤ –∫–∞–≤—ã—á–∫–∏-–¥–æ–ª–ª–∞—Ä—ã, –∫–∞–∫ –≤ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ. –ò–Ω–∞—á–µ –ø—Ä–∏–¥–µ—Ç—Å—è –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ–± —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–∞–≤—ã—á–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –≤—Å—Ç—Ä–µ—Ç—è—Ç—Å—è –≤ —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏. –°—Ä–∞–≤–Ω–∏—Ç–µ:

```sql
=> SELECT ' SELECT ''Hello, world!''; ';
         ?column?          
---------------------------
  SELECT 'Hello, world!'; 
(1 row)
```

```sql
=> SELECT $$ SELECT 'Hello, world!'; $$;
         ?column?          
---------------------------
  SELECT 'Hello, world!'; 
(1 row)
```

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–∞–≤—ã—á–∫–∏-–¥–æ–ª–ª–∞—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏. –î–ª—è —ç—Ç–æ–≥–æ –≤ –∫–∞–∂–¥–æ–π –ø–∞—Ä–µ –∫–∞–≤—ã—á–µ–∫ –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–π —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –¥–æ–ª–ª–∞—Ä–∞–º–∏:

```sql
=> SELECT $func$ SELECT $$Hello, world!$$; $func$;
          ?column?           
-----------------------------
  SELECT $$Hello, world!$$; 
(1 row)
```

–§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```sql
=> SELECT hello_world(); -- –ø—É—Å—Ç—ã–µ —Å–∫–æ–±–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
  hello_world  
---------------
 Hello, world!
(1 row)
```

–î–∞–≤–∞–π—Ç–µ –≤–∑–≥–ª—è–Ω–µ–º –Ω–∞ —Ç–æ, –∫–∞–∫ —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ.

```sql
=> \pset xheader_width 60
Expanded header width is 60.

=> SELECT proname, prosrc, prosqlbody FROM pg_proc
WHERE proname = 'hello_world' \gx
-[ RECORD 1 ]-------------------------
proname    | hello_world
prosrc     |  SELECT 'Hello, world!'; 
prosqlbody | 
```

–ú—ã –≤–∏–¥–∏–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –≤–∏–¥–µ —Ç–µ–ª–æ-—Å—Ç—Ä–æ–∫—É.

–ê —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –≤ –¥—Ä—É–≥–æ–º –≤–∏–¥–µ ‚Äî –≤ —Å—Ç–∏–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ SQL. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Ç–µ–ª–æ–º —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–∏–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–∞ RETURN <–≤—ã—Ä–∞–∂–µ–Ω–∏–µ>:

```sql
=> CREATE OR REPLACE FUNCTION hello_world() RETURNS text
LANGUAGE sql
RETURN 'Hello, world!';
CREATE FUNCTION
```

–°–Ω–æ–≤–∞ –∑–∞–≥–ª—è–Ω–µ–º –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ ‚Äî —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ø–æ-–¥—Ä—É–≥–æ–º—É:

```sql
=> SELECT proname, prosrc, left(prosqlbody, 100) AS body FROM pg_proc WHERE proname = 'hello_world' \gx
-[ RECORD 1 ]-----------------------------------------------
proname | hello_world
prosrc  | 
body    | {QUERY :commandType 1 :querySource 0 :canSetTag true :utilityStmt <> 
:resultRelation 0 :hasAggs fals
```

–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è, –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π `\sf`:

```sql
=> \sf hello_world
CREATE OR REPLACE FUNCTION public.hello_world()
 RETURNS text
 LANGUAGE sql
RETURN 'Hello, world!'::text
```

–í —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ SQL, –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—É—é –≤–µ—Ä–Ω—É–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä. –ï—Å–ª–∏ –∫–æ–¥ —Ç–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–ø–∏—Å–∞–Ω –≤ —Å—Ç–∏–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ SQL, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `BEGIN ATOMIC ... END`, –∫–æ—Ç–æ—Ä–∞—è –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–π –±–ª–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:

```sql
=> CREATE OR REPLACE FUNCTION hello_world() RETURNS text
LANGUAGE sql
BEGIN ATOMIC
  SELECT 'First Line';
  SELECT 'Second Line';
END;
CREATE FUNCTION
```

–ü—Ä–æ–±—É–µ–º –≤—ã–∑–æ–≤:

```sql
=> SELECT hello_world();
 hello_world 
-------------
 Second Line
(1 row)
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ —Å—Ç–∏–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ SQL ‚Äî –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ ¬´—Å—Ç—Ä–æ—á–Ω–æ–≥–æ¬ª:

* –Ω–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ `AS`, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏;
* –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–æ–≤–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `RETURN` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è;
* —É–∫–∞–∑–∞–Ω–∏–µ `LANGUAGE sql` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º;
* –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –µ–µ –∫–æ–¥ **—Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è**, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–∑–±–æ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `pg_proc.prosqlbody` (–≤ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–π –Ω–æ—Ç–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `pg_proc.prosrc`).

–≠—Ç–æ –ª—É—á—à–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –∏ –≤ –±–æ–ª—å—à–µ–π –º–µ—Ä–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –¥—Ä—É–≥–∏–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ SQL. –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –µ–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–Ω–æ–≤–æ –Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è, –∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ —Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.

---

–ù–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã SQL –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏–∏. –ó–∞–ø—Ä–µ—â–µ–Ω—ã:

* –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (`BEGIN`, `COMMIT`, `ROLLBACK` –∏ —Ç. –ø.);
* —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Ç–∞–∫–∏–µ, –∫–∞–∫ `VACUUM` –∏–ª–∏ `CREATE INDEX`).

–í–æ—Ç –ø—Ä–∏–º–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. –ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø—Å–µ–≤–¥–æ—Ç–∏–ø `void`, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∏—á–µ–≥–æ.

```sql
=> CREATE FUNCTION do_commit() RETURNS void
LANGUAGE sql
BEGIN ATOMIC COMMIT; END;
ERROR:  COMMIT is not yet supported in unquoted SQL function body
```

–£–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –º–æ–∂–Ω–æ –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö, –æ —á–µ–º –º—ã –±—É–¥–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º–µ.

---

# –§—É–Ω–∫—Ü–∏–∏ —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

–ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–¥–Ω–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º:

```sql
=> CREATE FUNCTION hello(name text) -- —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
RETURNS text
LANGUAGE sql
RETURN 'Hello, ' || name || '!';
CREATE FUNCTION
```

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–º—É:

```sql
=> SELECT hello('Alice');
     hello     
---------------
 Hello, Alice!
(1 row)
```

–ü—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Ç–∏–ø–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `varchar(10)`), –Ω–æ –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.

–ú–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–º–µ–Ω–∏; —Ç–æ–≥–¥–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–ª–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–¥–µ—Ç—Å—è —Å—Å—ã–ª–∞—Ç—å—Å—è –ø–æ –Ω–æ–º–µ—Ä—É. –£–¥–∞–ª–∏–º —Ñ—É–Ω–∫—Ü–∏—é –∏ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é:

```sql
=> DROP FUNCTION hello(text); -- –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
DROP FUNCTION

=> CREATE FUNCTION hello(text)
RETURNS text
LANGUAGE sql
RETURN 'Hello, ' || $1 || '!'; -- –Ω–æ–º–µ—Ä –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω–∏
CREATE FUNCTION

=> SELECT hello('Alice');
     hello     
---------------
 Hello, Alice!
(1 row)
```

–ù–æ —Ç–∞–∫ –ª—É—á—à–µ –Ω–µ –¥–µ–ª–∞—Ç—å, —ç—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ.

–£–¥–∞–ª–∏–º —Ñ—É–Ω–∫—Ü–∏—é –∏ —Å–æ–∑–¥–∞–¥–∏–º –∑–∞–Ω–æ–≤–æ, –¥–æ–±–∞–≤–∏–≤ –µ—â–µ –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ.

```sql
=> DROP FUNCTION hello(text);
DROP FUNCTION
```

–ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `IN`, –æ–±–æ–∑–Ω–∞—á–∞—é—â–µ–µ –≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ `DEFAULT` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:

```sql
=> CREATE FUNCTION hello(IN name text, IN greet text DEFAULT 'Dear', IN title text DEFAULT 'Mr')
RETURNS text
LANGUAGE sql
RETURN 'Hello, ' || greet || ' ' || title || ' ' || name || '!';
CREATE FUNCTION
```

```sql
=> SELECT hello('Alice', 'Charming', 'Mrs'); -- —É–∫–∞–∑–∞–Ω—ã –≤—Ç–æ—Ä–æ–π –∏ —Ç—Ä–µ—Ç–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
           hello            
----------------------------
 Hello, Charming Mrs Alice!
(1 row)
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –≤ –∫–æ–Ω—Ü–µ –≤—Å–µ–≥–æ —Å–ø–∏—Å–∫–∞. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫–∞–∫ `DEFAULT`, –º–æ–∂–Ω–æ –æ–ø—É—Å–∫–∞—Ç—å, —Ç–æ–≥–¥–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ `DEFAULT`-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∏–¥—É—â–∏–µ –≤ —Å–ø–∏—Å–∫–µ –ø–æ—Å–ª–µ, —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```sql
=> SELECT hello('Bob', 'Excellent'); -- —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π default-–ø–∞—Ä–∞–º–µ—Ç—Ä
          hello           
--------------------------
 Hello, Excellent Mr Bob!
(1 row)

=> SELECT hello('Bob'); -- –æ–ø—É—â–µ–Ω—ã –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –∏–º–µ—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        hello        
---------------------
 Hello, Dear Mr Bob!
(1 row)
```

–î–æ —Å–∏—Ö –ø–æ—Ä –º—ã –≤—ã–∑—ã–≤–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é, —É–∫–∞–∑—ã–≤–∞—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã **–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º** ‚Äî –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏. –í–æ –º–Ω–æ–≥–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –∑–∞–¥–∞–Ω—ã, —Ç–∞–∫ —á—Ç–æ —ç—Ç–æ—Ç —Å–ø–æ—Å–æ–± –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º.

–ù–æ –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –¥–∞–Ω—ã –∏–º–µ–Ω–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤ **–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**:

```sql
=> SELECT hello(title => 'Mrs', name => 'Alice');
         hello          
------------------------
 Hello, Dear Mrs Alice!
(1 row)
```

–¢–∞–∫–æ–π —Å–ø–æ—Å–æ–± —É–¥–æ–±–µ–Ω, –∫–æ–≥–¥–∞ –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ–æ—á–µ–≤–∏–¥–µ–Ω, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏—Ö –º–Ω–æ–≥–æ; —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–ú–æ–∂–Ω–æ —Å–æ–≤–º–µ—â–∞—Ç—å –æ–±–∞ —Å–ø–æ—Å–æ–±–∞: —á–∞—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞—á–∏–Ω–∞—è —Å –ø–µ—Ä–≤–æ–≥–æ) —É–∫–∞–∑–∞—Ç—å **–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ**, –∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è ‚Äî **–ø–æ –∏–º–µ–Ω–∏**:

```sql
=> SELECT hello('Alice', title => 'Mrs');
         hello          
------------------------
 Hello, Dear Mrs Alice!
(1 row)
```

–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å **–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**, –∫–æ–≥–¥–∞ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ **–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω**, –µ–µ –º–æ–∂–Ω–æ –æ–±—ä—è–≤–∏—Ç—å –∫–∞–∫ **—Å—Ç—Ä–æ–≥—É—é** (`STRICT`). –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ —ç—Ç–æ–º –≤–æ–æ–±—â–µ –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è.

```sql
=> DROP FUNCTION hello(text, text, text);
DROP FUNCTION

=> CREATE FUNCTION hello(IN name text, IN title text DEFAULT 'Mr')
RETURNS text
LANGUAGE sql STRICT
RETURN 'Hello, ' || title || ' ' || name || '!';
CREATE FUNCTION

=> SELECT hello('Alice', NULL);
 hello 
-------
 
(1 row)
```


![alt text](image-4.png)


–§–æ—Ä–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å —Ä–µ–∂–∏–º–æ–º `IN` –∏ `INOUT` —Å—á–∏—Ç–∞—é—Ç—Å—è –≤—Ö–æ–¥–Ω—ã–º–∏.  
–ó–Ω–∞—á–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏  
(–ª–∏–±–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:  
‚óè –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ `RETURNS` –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞;  
‚óè –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å —Ä–µ–∂–∏–º–æ–º `INOUT` –∏–ª–∏ `OUT`.

–î–≤–µ —ç—Ç–∏ —Ñ–æ—Ä–º—ã –∑–∞–ø–∏—Å–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã.  
–ù–∞–ø—Ä–∏–º–µ—Ä, —Ñ—É–Ω–∫—Ü–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `RETURNS integer` –∏ —Ñ—É–Ω–∫—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `OUT integer` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ.

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –æ–±–∞ —Å–ø–æ—Å–æ–±–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.  
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ñ—É–Ω–∫—Ü–∏—è —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–¥–Ω–æ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ.  
–ù–æ –ø—Ä–∏ —ç—Ç–æ–º —Ç–∏–ø—ã `RETURNS` –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–µ–ª—å–∑—è –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ,  
–∏ –ø—Ä–∏ —ç—Ç–æ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ `OUT`-–ø–∞—Ä–∞–º–µ—Ç—Ä–µ ‚Äî  
—á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.


# –ü–†–ê–ö–¢–ò–ö–ê


# –§—É–Ω–∫—Ü–∏–∏ —Å –≤—ã—Ö–æ–¥–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä.

```sql
=> DROP FUNCTION hello(text, text);
DROP FUNCTION

=> CREATE FUNCTION hello(
    IN name text,
    OUT text -- –∏–º—è –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ
)
LANGUAGE sql
RETURN 'Hello, ' || name || '!';
CREATE FUNCTION

=> SELECT hello('Alice');
     hello     
---------------
 Hello, Alice!
(1 row)
````

–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π.

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ `RETURNS`, –∏ `OUT`-–ø–∞—Ä–∞–º–µ—Ç—Ä –≤–º–µ—Å—Ç–µ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–Ω–æ–≤–∞ –±—É–¥–µ—Ç —Ç–µ–º –∂–µ:

```sql
=> DROP FUNCTION hello(text); -- OUT-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ–º
DROP FUNCTION

=> CREATE FUNCTION hello(IN name text, OUT text)
RETURNS text
LANGUAGE sql
RETURN 'Hello, ' || name || '!';
CREATE FUNCTION

=> SELECT hello('Alice');
     hello     
---------------
 Hello, Alice!
(1 row)
```

–ò–ª–∏ –¥–∞–∂–µ —Ç–∞–∫, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤ `INOUT`-–ø–∞—Ä–∞–º–µ—Ç—Ä:

```sql
=> DROP FUNCTION hello(text);
DROP FUNCTION

=> CREATE FUNCTION hello(INOUT name text)
LANGUAGE sql
RETURN 'Hello, ' || name || '!';
CREATE FUNCTION

=> SELECT hello('Alice');
     hello     
---------------
 Hello, Alice!
(1 row)
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –º–Ω–æ–≥–∏—Ö —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –≤ `INOUT`-–ø–∞—Ä–∞–º–µ—Ç—Ä–µ, –Ω–∏–∫–∞–∫ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è: –º—ã –ø–µ—Ä–µ–¥–∞–µ–º –≤—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –≤—ã—Ö–æ–¥–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ü–æ—ç—Ç–æ–º—É –º—ã –º–æ–∂–µ–º —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É, —Ö–æ—Ç—è –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ –±—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

–í —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –≤ `RETURNS` –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ. –ù–∞–ø—Ä–∏–º–µ—Ä:

```sql
=> DROP FUNCTION hello(text);
DROP FUNCTION

=> CREATE FUNCTION hello(
    IN name text,
    OUT greeting text,
    OUT clock timetz)
LANGUAGE sql
RETURN ('Hello, ' || name || '!', current_time);
CREATE FUNCTION
```

–ó–¥–µ—Å—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ `RETURN` –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ—Å—å –≤–∑—è—Ç—å –≤ —Å–∫–æ–±–∫–∏.

```sql
=> SELECT hello('Alice');
                hello                 
--------------------------------------
 ("Hello, Alice!",10:30:32.568396+03)
(1 row)
```

![alt text](image-5.png)


–ö–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–≤–æ–π—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

–ö–∞—Ç–µ–≥–æ—Ä–∏—è `volatile` –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ –º–µ–Ω—è—Ç—å—Å—è. –¢–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ. –ï—Å–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ —ç—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è.

–ö–∞—Ç–µ–≥–æ—Ä–∏—è `stable` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ SQL-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, —Ç–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î. –¢–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, –∞ –∑–∞—Ç–µ–º –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

–ö–∞—Ç–µ–≥–æ—Ä–∏—è `immutable` –µ—â–µ –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∏–∫–æ–≥–¥–∞. –¢–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, –∞ –Ω–µ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–ú–æ–∂–Ω–æ ‚Äî –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–º–µ–Ω–Ω–æ —Ç–∞–∫, –Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤–ø—Ä–∞–≤–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö (–ø—Ä–æ—Å—Ç—ã—Ö) —Å–ª—É—á–∞—è—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–µ–ª–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—ã –æ–± –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–µ–≤–∑–∏—Ä–∞—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é —è–≤–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.

https://postgrespro.ru/docs/postgresql/16/xfunc-volatility


![alt text](image-6.png)


# –ü—Ä–∞–∫—Ç–∏–∫–∞

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è

–í —Ü–µ–ª–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –µ—Å—Ç—å –¥–≤–∞ –º–æ–º–µ–Ω—Ç–∞, –æ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª–µ–∑–Ω–æ –∑–Ω–∞—Ç—å.

–í–æ-–ø–µ—Ä–≤—ã—Ö, —Ñ—É–Ω–∫—Ü–∏–∏ —Å –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å—é volatile –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–∑–æ–ª—è—Ü–∏–∏ Read Committed –ø—Ä–∏–≤–æ–¥—è—Ç –∫ —Ä–∞—Å—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

–°–¥–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:

```sql
=> CREATE TABLE t(n integer);
CREATE TABLE
=> CREATE FUNCTION cnt() RETURNS bigint
LANGUAGE sql VOLATILE 
RETURN (SELECT count(*) FROM t);
CREATE FUNCTION
````

–¢–µ–ø–µ—Ä—å –≤—ã–∑–æ–≤–µ–º –µ–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, –∞ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º —Å–µ–∞–Ω—Å–µ –≤—Å—Ç–∞–≤–∏–º –≤ —Ç–∞–±–ª–∏—Ü—É —Å—Ç—Ä–æ–∫—É.

```sql
=> BEGIN ISOLATION LEVEL READ COMMITTED;
BEGIN
=> SELECT (SELECT count(*) FROM t), cnt(), pg_sleep(1)
FROM generate_series(1,4);
=> INSERT INTO t VALUES (1);
INSERT 0 1

 count | cnt | pg_sleep 
-------+-----+----------
     0 |   0 | 
     0 |   0 | 
     0 |   1 | 
     0 |   1 | 
(4 rows)

=> END;
COMMIT
```

–ü—Ä–∏ –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ stable –∏–ª–∏ immutable, –ª–∏–±–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏—Ö —É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–∞–∫–æ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤ —ç—Ç–∏—Ö —Å–ª—É—á–∞—è—Ö –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–Ω–∏–º–æ–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∂–µ –ø—Ä–∏–º–µ—Ä–µ (volatile, Read Committed) –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –∏ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ —Å–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

```sql
=> ALTER FUNCTION cnt() STABLE;
ALTER FUNCTION
=> TRUNCATE t;
TRUNCATE TABLE
=> BEGIN ISOLATION LEVEL READ COMMITTED;
BEGIN
=> SELECT (SELECT count(*) FROM t), cnt(), pg_sleep(1)
FROM generate_series(1,4);
=> INSERT INTO t VALUES (1);
INSERT 0 1

 count | cnt | pg_sleep 
-------+-----+----------
     0 |   0 | 
     0 |   0 | 
     0 |   0 | 
     0 |   0 | 
(4 rows)

=> END;
COMMIT
```

–í—Ç–æ—Ä–æ–π –º–æ–º–µ–Ω—Ç —Å–≤—è–∑–∞–Ω —Å –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π.

–§—É–Ω–∫—Ü–∏–∏ —Å –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å—é volatile –≤–∏–¥—è—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Å–¥–µ–ª–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–∏–º, –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º SQL.

```sql
=> ALTER FUNCTION cnt() VOLATILE;
ALTER FUNCTION
=> TRUNCATE t;
TRUNCATE TABLE
=> INSERT INTO t SELECT cnt() FROM generate_series(1,5);
INSERT 0 5
=> SELECT * FROM t;
 n 
---
 0
 1
 2
 3
 4
(5 rows)
```

–≠—Ç–æ –≤–µ—Ä–Ω–æ –¥–ª—è –ª—é–±—ã—Ö —É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏.

–§—É–Ω–∫—Ü–∏–∏ —Å –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å—é stable –∏–ª–∏ immutable –≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤.

```sql
=> ALTER FUNCTION cnt() STABLE;
ALTER FUNCTION
=> TRUNCATE t;
TRUNCATE TABLE
=> INSERT INTO t SELECT cnt() FROM generate_series(1,5);
INSERT 0 5
=> SELECT * FROM t;
 n 
---
 0
 0
 0
 0
 0
(5 rows)
```

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–ë–ª–∞–≥–æ–¥–∞—Ä—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é –¥–∞–µ—Ç —É–∫–∞–∑–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏, –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –Ω–∞ –≤—ã–∑–æ–≤–∞—Ö —Ñ—É–Ω–∫—Ü–∏–∏.

–î–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ:

```sql
=> CREATE FUNCTION rnd() RETURNS float
LANGUAGE sql VOLATILE 
RETURN random();
CREATE FUNCTION
```

–ü—Ä–æ–≤–µ—Ä–∏–º –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```sql
=> EXPLAIN (costs off)
SELECT * FROM generate_series(1,10) WHERE rnd() > 0.5;
                   QUERY PLAN                   
------------------------------------------------
 Function Scan on generate_series
   Filter: (random() > '0.5'::double precision)
(2 rows)
```

–í –ø–ª–∞–Ω–µ –º—ã –≤–∏–¥–∏–º ¬´—á–µ—Å—Ç–Ω–æ–µ¬ª –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Ñ—É–Ω–∫—Ü–∏–∏ generate\_series; –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º —á–∏—Å–ª–æ–º –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä–æ–º.

–í —ç—Ç–æ–º –º–æ–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è –∏ –≤–æ–æ—á–∏—é:

```sql
=> SELECT * FROM generate_series(1,10) WHERE rnd() > 0.5;
 generate_series 
-----------------
               1
               4
(2 rows)

=> \g
 generate_series 
-----------------
               1
               4
               5
               7
               8
              10
(6 rows)

=> \g
 generate_series 
-----------------
               1
               2
               3
               4
               5
(5 rows)

=> \g
 generate_series 
-----------------
               5
               8
              10
(3 rows)

=> \g
 generate_series 
-----------------
               1
               4
               5
               6
               7
               9
(6 rows)
```

–ó–¥–µ—Å—å —Å —Ä–∞–∑–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –ø–æ–ª—É—á–∞–µ–º –æ—Ç 0 –¥–æ 10 —Å—Ç—Ä–æ–∫.

–§—É–Ω–∫—Ü–∏—è —Å –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å—é stable –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –≤—Å–µ–≥–æ –æ–¥–∏–Ω —Ä–∞–∑ ‚Äî –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É–∫–∞–∑–∞–ª–∏, —á—Ç–æ –µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞:

```sql
=> ALTER FUNCTION rnd() STABLE;
ALTER FUNCTION
=> EXPLAIN (costs off)
SELECT * FROM generate_series(1,10) WHERE rnd() > 0.5;
                      QUERY PLAN                      
------------------------------------------------------
 Result
   One-Time Filter: (rnd() > '0.5'::double precision)
   ->  Function Scan on generate_series
(3 rows)
```

–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞ –±—É–¥–µ—Ç –ª–∏–±–æ 0, –ª–∏–±–æ 10 —Å—Ç—Ä–æ–∫.

```sql
=> SELECT * FROM generate_series(1,10) WHERE rnd() > 0.5;
 generate_series 
-----------------
               1
               2
               3
               4
               5
               6
               7
               8
               9
              10
(10 rows)

=> \g
 generate_series 
-----------------
               1
               2
               3
               4
               5
               6
               7
               8
               9
              10
(10 rows)

=> \g
 generate_series 
-----------------
(0 rows)

=> \g
 generate_series 
-----------------
               1
               2
               3
               4
               5
               6
               7
               8
               9
              10
(10 rows)
```

–ù–∞–∫–æ–Ω–µ—Ü, –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å immutable –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –µ—â–µ –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ —É–∂–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

```sql
=> ALTER FUNCTION rnd() IMMUTABLE;
ALTER FUNCTION
=> EXPLAIN (costs off)
SELECT * FROM generate_series(1,10) WHERE rnd() > 0.5;
        QUERY PLAN        
--------------------------
 Result
   One-Time Filter: false
(2 rows)

=> \g
            QUERY PLAN            
----------------------------------
 Function Scan on generate_series
(1 row)

=> \g
        QUERY PLAN        
--------------------------
 Result
   One-Time Filter: false
(2 rows)
```

–î–ª—è immutable –ø–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–ª–∞–Ω!

–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å ¬´–∑–∞ –¥–∞—á—É –∑–∞–≤–µ–¥–æ–º–æ –ª–æ–∂–Ω—ã—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π¬ª –ª–µ–∂–∏—Ç –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–µ.

## –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–ª–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ SQL-–∑–∞–ø—Ä–æ—Å

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö (–æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã—Ö) —Å–ª—É—á–∞—è—Ö —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —è–∑—ã–∫–µ SQL –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –ø—Ä—è–º–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π SQL-–æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑–±–æ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—Ä–µ–º—è –Ω–∞ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è.

–£–ø—Ä–æ—â–µ–Ω–Ω–æ ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —É—Å–ª–æ–≤–∏–π:

* –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ SELECT;
* –ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Ç–∞–±–ª–∏—Ü–∞–º, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏ —Ç. –ø.;
* –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–Ω–æ;
* –í—ã–∑—ã–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç—å —É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏.

–ü—Ä–∏–º–µ—Ä –º—ã —É–∂–µ –≤–∏–¥–µ–ª–∏: –Ω–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è rnd(), –æ–±—ä—è–≤–ª–µ–Ω–Ω–∞—è volatile.

–ü–æ—Å–º–æ—Ç—Ä–∏–º –µ—â–µ —Ä–∞–∑.

```sql
=> ALTER FUNCTION rnd() VOLATILE;
ALTER FUNCTION
=> EXPLAIN (costs off)
SELECT * FROM generate_series(1,10) WHERE rnd() > 0.5;
                   QUERY PLAN                   
------------------------------------------------
 Function Scan on generate_series
   Filter: (random() > '0.5'::double precision)
(2 rows)
```

–í —Ñ–∏–ª—å—Ç—Ä–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `random()`, –Ω–æ –Ω–µ `rnd()`. –û–Ω–∞ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é, –º–∏–Ω—É—è ¬´–æ–±–µ—Ä—Ç–∫—É¬ª –≤ –≤–∏–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏ `rnd()`.




![alt text](image-8.png)